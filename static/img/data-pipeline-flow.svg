<svg viewBox="0 0 600 400" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .flow-label { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 12px; font-weight: 600; fill: #1e293b; }
      .flow-desc { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 10px; fill: #475569; }
      .stage-title { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 11px; font-weight: 600; fill: #0f172a; }
      .main-title { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-size: 16px; font-weight: 700; fill: #1a252f; }
    </style>
    
    <!-- Arrow marker -->
    <marker id="flow-arrow" markerWidth="8" markerHeight="8" refX="7" refY="4" orient="auto">
      <polygon points="0 0, 8 4, 0 8" fill="#64748b" />
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="600" height="400" fill="#ffffff" rx="8"/>
  
  <!-- Title -->
  <text x="300" y="30" text-anchor="middle" class="main-title">
    Zero-Allocation Data Flow
  </text>
  
  <!-- Stage 1: Ingestion -->
  <g transform="translate(50, 70)">
    <rect width="120" height="80" rx="6" fill="#eff6ff" stroke="#3b82f6" stroke-width="2"/>
    <text x="60" y="25" text-anchor="middle" class="stage-title">1. Ingestion</text>
    <text x="60" y="42" text-anchor="middle" class="flow-desc">IAsyncEnumerable</text>
    <text x="60" y="56" text-anchor="middle" class="flow-desc">streaming source</text>
    <text x="60" y="70" text-anchor="middle" class="flow-desc">ValueTask&lt;T&gt;</text>
  </g>
  
  <!-- Stage 2: Processing -->
  <g transform="translate(240, 70)">
    <rect width="120" height="80" rx="6" fill="#f0f9ff" stroke="#0ea5e9" stroke-width="2"/>
    <text x="60" y="25" text-anchor="middle" class="stage-title">2. Processing</text>
    <text x="60" y="42" text-anchor="middle" class="flow-desc">Pre-compiled</text>
    <text x="60" y="56" text-anchor="middle" class="flow-desc">delegates</text>
    <text x="60" y="70" text-anchor="middle" class="flow-desc">Zero reflection</text>
  </g>
  
  <!-- Stage 3: Output -->
  <g transform="translate(430, 70)">
    <rect width="120" height="80" rx="6" fill="#ecfdf5" stroke="#10b981" stroke-width="2"/>
    <text x="60" y="25" text-anchor="middle" class="stage-title">3. Output</text>
    <text x="60" y="42" text-anchor="middle" class="flow-desc">Async sinks</text>
    <text x="60" y="56" text-anchor="middle" class="flow-desc">batched writes</text>
    <text x="60" y="70" text-anchor="middle" class="flow-desc">backpressure</text>
  </g>
  
  <!-- Arrows -->
  <path d="M 170 110 L 240 110" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#flow-arrow)"/>
  <path d="M 360 110 L 430 110" stroke="#64748b" stroke-width="2" fill="none" marker-end="url(#flow-arrow)"/>
  
  <!-- Memory Profile -->
  <g transform="translate(50, 190)">
    <text x="0" y="0" class="flow-label">Memory Profile:</text>
    
    <!-- Memory graph visualization -->
    <rect x="0" y="15" width="500" height="120" fill="#f8fafc" stroke="#cbd5e1" stroke-width="1" rx="4"/>
    
    <!-- Grid lines -->
    <line x1="0" y1="95" x2="500" y2="95" stroke="#e2e8f0" stroke-width="1" stroke-dasharray="4,4"/>
    <line x1="0" y1="135" x2="500" y2="135" stroke="#e2e8f0" stroke-width="1"/>
    
    <!-- Traditional approach (high allocation) -->
    <path d="M 0 95 L 50 75 L 100 85 L 150 65 L 200 55 L 250 45 L 300 35 L 350 25 L 400 35 L 450 45 L 500 55" 
          stroke="#ef4444" stroke-width="2.5" fill="none" opacity="0.7" stroke-dasharray="5,3"/>
    
    <!-- NPipeline (constant memory) -->
    <path d="M 0 125 L 500 125" stroke="#10b981" stroke-width="2.5" fill="none"/>
    
    <!-- Labels -->
    <text x="10" y="160" class="flow-desc">Time →</text>
    <text x="10" y="25" class="flow-desc">Memory</text>
    <text x="10" y="37" class="flow-desc">Usage</text>
    
    <!-- Legend -->
    <g transform="translate(150, 150)">
      <line x1="0" y1="0" x2="30" y2="0" stroke="#ef4444" stroke-width="2.5" stroke-dasharray="5,3" opacity="0.7"/>
      <text x="35" y="4" class="flow-desc">Traditional (growing allocations)</text>
      
      <line x1="0" y1="15" x2="30" y2="15" stroke="#10b981" stroke-width="2.5"/>
      <text x="35" y="19" class="flow-desc">NPipeline (constant memory)</text>
    </g>
  </g>
  
  <!-- Key Benefits -->
  <g transform="translate(50, 340)">
    <text x="0" y="0" class="flow-label">Zero-Allocation Benefits:</text>
    <text x="0" y="18" class="flow-desc">• Predictable latency without GC pauses</text>
    <text x="0" y="32" class="flow-desc">• O(1) memory complexity for unlimited data</text>
    <text x="0" y="46" class="flow-desc">• Reduced CPU overhead from collection pressure</text>
  </g>
</svg>
