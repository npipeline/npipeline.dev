"use strict";(self.webpackChunknpipeline=self.webpackChunknpipeline||[]).push([[8509],{28453:(e,i,n)=>{n.d(i,{R:()=>c,x:()=>a});var t=n(96540);const r={},s=t.createContext(r);function c(e){const i=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),t.createElement(s.Provider,{value:i},e.children)}},44761:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"extensions/observability/tracing","title":"Distributed Tracing","description":"OpenTelemetry-compatible distributed tracing for NPipeline pipelines using System.Diagnostics.Activity.","source":"@site/docs/extensions/observability/tracing.md","sourceDirName":"extensions/observability","slug":"/extensions/observability/tracing","permalink":"/docs/extensions/observability/tracing","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"title":"Distributed Tracing","description":"OpenTelemetry-compatible distributed tracing for NPipeline pipelines using System.Diagnostics.Activity.","sidebar_position":7},"sidebar":"docsSidebar","previous":{"title":"OpenTelemetry Integration","permalink":"/docs/extensions/observability/opentelemetry"},"next":{"title":"Advanced Observability Patterns","permalink":"/docs/extensions/observability/advanced-patterns"}}');var r=n(74848),s=n(28453);const c={title:"Distributed Tracing",description:"OpenTelemetry-compatible distributed tracing for NPipeline pipelines using System.Diagnostics.Activity.",sidebar_position:7},a="Distributed Tracing",l={},d=[{value:"Overview",id:"overview",level:2},{value:"What is PipelineActivity?",id:"what-is-pipelineactivity",level:2},{value:"When to Use Which Approach?",id:"when-to-use-which-approach",level:2},{value:"Use Core Tracing (PipelineActivity) If:",id:"use-core-tracing-pipelineactivity-if",level:3},{value:"Use OpenTelemetry Integration If:",id:"use-opentelemetry-integration-if",level:3},{value:"Basic Usage",id:"basic-usage",level:2},{value:"Creating a Custom Tracer",id:"creating-a-custom-tracer",level:3},{value:"Registering with Dependency Injection",id:"registering-with-dependency-injection",level:3},{value:"Using the Tracer in Your Pipeline",id:"using-the-tracer-in-your-pipeline",level:3},{value:"Tag Guidelines",id:"tag-guidelines",level:2},{value:"Standard Tags",id:"standard-tags",level:3},{value:"Exception Handling",id:"exception-handling",level:2},{value:"OpenTelemetry Integration",id:"opentelemetry-integration",level:2},{value:"Jaeger Example",id:"jaeger-example",level:3},{value:"Activity Hierarchies",id:"activity-hierarchies",level:2},{value:"Testing Activities",id:"testing-activities",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"See Also",id:"see-also",level:2}];function o(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"distributed-tracing",children:"Distributed Tracing"})}),"\n",(0,r.jsx)(i.p,{children:"NPipeline provides two approaches for distributed tracing:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Core Tracing"})," (this page): Build your own tracer using ",(0,r.jsx)(i.code,{children:"PipelineActivity"})," wrapper"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"OpenTelemetry Integration"}),": Use the dedicated ",(0,r.jsx)(i.code,{children:"NPipeline.Extensions.Observability.OpenTelemetry"})," package for seamless OpenTelemetry integration (see ",(0,r.jsx)(i.a,{href:"/docs/extensions/observability/opentelemetry",children:"OpenTelemetry Integration"}),")"]}),"\n"]}),"\n",(0,r.jsxs)(i.p,{children:["Both approaches use ",(0,r.jsx)(i.code,{children:"System.Diagnostics.Activity"})," under the hood, making them compatible with .NET's native tracing infrastructure. Choose the approach that best fits your observability needs."]}),"\n",(0,r.jsx)(i.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(i.p,{children:"Distributed tracing enables you to track the flow of data and execution across complex pipeline topologies. This is essential for:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Root cause analysis"}),": Understand where failures occur in multi-stage pipelines"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Performance profiling"}),": Identify slow stages and optimization opportunities"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Dependency correlation"}),": Trace related operations across different services and pipelines"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Observability integration"}),": Export traces to OpenTelemetry-compatible backends (Jaeger, Zipkin, etc.)"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"what-is-pipelineactivity",children:"What is PipelineActivity?"}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.code,{children:"PipelineActivity"})," is an implementation of the ",(0,r.jsx)(i.code,{children:"IPipelineActivity"})," interface that bridges NPipeline's activity abstraction with ",(0,r.jsx)(i.code,{children:"System.Diagnostics.Activity"}),":"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:"public sealed class PipelineActivity(Activity activity) : IPipelineActivity\n{\n    public void SetTag(string key, object value) { ... }\n    public void RecordException(Exception exception) { ... }\n    public void Dispose() { ... }\n}\n"})}),"\n",(0,r.jsxs)(i.p,{children:["The class delegates all operations to the underlying ",(0,r.jsx)(i.code,{children:"Activity"}),", which is part of the .NET runtime and integrates seamlessly with OpenTelemetry instrumentation."]}),"\n",(0,r.jsx)(i.h2,{id:"when-to-use-which-approach",children:"When to Use Which Approach?"}),"\n",(0,r.jsx)(i.h3,{id:"use-core-tracing-pipelineactivity-if",children:"Use Core Tracing (PipelineActivity) If:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"You want lightweight, custom tracing without external dependencies"}),"\n",(0,r.jsx)(i.li,{children:"You're building your own observability solution"}),"\n",(0,r.jsx)(i.li,{children:"You need full control over how activities are created and managed"}),"\n",(0,r.jsx)(i.li,{children:"You're exporting traces manually or using a non-standard backend"}),"\n",(0,r.jsx)(i.li,{children:"You want to understand the fundamentals of how tracing works"}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"use-opentelemetry-integration-if",children:"Use OpenTelemetry Integration If:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"You need production-grade distributed tracing with multiple backends"}),"\n",(0,r.jsx)(i.li,{children:"You want to export traces to Jaeger, Zipkin, Azure Application Insights, or AWS X-Ray"}),"\n",(0,r.jsx)(i.li,{children:"You prefer standardized telemetry configuration via OpenTelemetry SDKs"}),"\n",(0,r.jsx)(i.li,{children:"You're integrating with existing OpenTelemetry infrastructure"}),"\n",(0,r.jsx)(i.li,{children:"You want dependency injection convenience with minimal configuration"}),"\n",(0,r.jsx)(i.li,{children:"You need comprehensive activity filtering and sampling options"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,r.jsx)(i.h3,{id:"creating-a-custom-tracer",children:"Creating a Custom Tracer"}),"\n",(0,r.jsxs)(i.p,{children:["To use distributed tracing with NPipeline, implement ",(0,r.jsx)(i.code,{children:"IPipelineTracer"}),":"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:'using System.Diagnostics;\nusing NPipeline.Extensions.Observability.Tracing;\nusing NPipeline.Observability.Tracing;\n\npublic class SystemDiagnosticsTracer : IPipelineTracer\n{\n    private readonly string _serviceName;\n\n    public SystemDiagnosticsTracer(string serviceName = "NPipeline")\n    {\n        _serviceName = serviceName;\n    }\n\n    public IPipelineActivity StartActivity(string name)\n    {\n        var activity = new Activity($"{_serviceName}.{name}")\n            .Start();\n\n        return activity != null \n            ? new PipelineActivity(activity)\n            : new NullPipelineActivity();\n    }\n}\n'})}),"\n",(0,r.jsx)(i.h3,{id:"registering-with-dependency-injection",children:"Registering with Dependency Injection"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:'using Microsoft.Extensions.DependencyInjection;\n\nvar services = new ServiceCollection();\n\n// Add observability\nservices.AddNPipelineObservability();\n\n// Register the custom tracer as a singleton\nservices.AddSingleton<IPipelineTracer>(new SystemDiagnosticsTracer("MyPipeline"));\n\nvar provider = services.BuildServiceProvider();\n'})}),"\n",(0,r.jsx)(i.h3,{id:"using-the-tracer-in-your-pipeline",children:"Using the Tracer in Your Pipeline"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:"var context = new PipelineContext(\n    PipelineContextConfiguration.WithObservability(\n        tracer: provider.GetRequiredService<IPipelineTracer>()\n    )\n);\n\nawait runner.RunAsync<MyPipeline>(context);\n"})}),"\n",(0,r.jsx)(i.h2,{id:"tag-guidelines",children:"Tag Guidelines"}),"\n",(0,r.jsx)(i.p,{children:"Tags are arbitrary key-value pairs that provide context for the activity. Use them to record:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:'activity.SetTag("node_id", "source_stage");\nactivity.SetTag("batch_size", 100);\nactivity.SetTag("throughput_items_per_sec", 1234.5);\nactivity.SetTag("duration_ms", 5000);\nactivity.SetTag("item_count", 50);\nactivity.SetTag("error_count", 2);\n'})}),"\n",(0,r.jsx)(i.h3,{id:"standard-tags",children:"Standard Tags"}),"\n",(0,r.jsx)(i.p,{children:"While tags are flexible, consider using standard names for interoperability:"}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Tag Name"}),(0,r.jsx)(i.th,{children:"Type"}),(0,r.jsx)(i.th,{children:"Purpose"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"node_id"})}),(0,r.jsx)(i.td,{children:"string"}),(0,r.jsx)(i.td,{children:"Identifier of the executing node"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"node_type"})}),(0,r.jsx)(i.td,{children:"string"}),(0,r.jsx)(i.td,{children:'Type of node (e.g., "SourceNode", "TransformNode")'})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"batch_size"})}),(0,r.jsx)(i.td,{children:"integer"}),(0,r.jsx)(i.td,{children:"Number of items in the current batch"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"item_count"})}),(0,r.jsx)(i.td,{children:"integer"}),(0,r.jsx)(i.td,{children:"Number of items processed"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"throughput_items_per_sec"})}),(0,r.jsx)(i.td,{children:"double"}),(0,r.jsx)(i.td,{children:"Items processed per second"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"duration_ms"})}),(0,r.jsx)(i.td,{children:"integer"}),(0,r.jsx)(i.td,{children:"Duration in milliseconds"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"memory_mb"})}),(0,r.jsx)(i.td,{children:"integer"}),(0,r.jsx)(i.td,{children:"Memory usage in megabytes"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:(0,r.jsx)(i.code,{children:"processor_time_ms"})}),(0,r.jsx)(i.td,{children:"integer"}),(0,r.jsx)(i.td,{children:"Processor time in milliseconds"})]})]})]}),"\n",(0,r.jsx)(i.h2,{id:"exception-handling",children:"Exception Handling"}),"\n",(0,r.jsx)(i.p,{children:"When a pipeline node fails, record the exception to provide detailed error context:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:'public IPipelineActivity StartActivity(string name)\n{\n    var activity = new Activity($"{name}").Start();\n    return new PipelineActivity(activity);\n}\n\n// In error handling:\ntry\n{\n    // Node execution\n}\ncatch (Exception ex)\n{\n    activity.RecordException(ex);\n    throw;\n}\n'})}),"\n",(0,r.jsxs)(i.p,{children:["The ",(0,r.jsx)(i.code,{children:"RecordException"})," method automatically:"]}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:["Sets the activity status to ",(0,r.jsx)(i.code,{children:"Error"})]}),"\n",(0,r.jsx)(i.li,{children:"Records the exception type, message, and stack trace"}),"\n",(0,r.jsx)(i.li,{children:'Adds an "exception" event with detailed information'}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"opentelemetry-integration",children:"OpenTelemetry Integration"}),"\n",(0,r.jsx)(i.p,{children:"To export traces to OpenTelemetry backends like Jaeger or Zipkin:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:'using OpenTelemetry;\nusing OpenTelemetry.Trace;\n\nvar tracerProvider = new TracerProviderBuilder()\n    .AddSource("NPipeline") // Match your service name\n    .AddJaegerExporter()     // Or AddZipkinExporter(), etc.\n    .Build();\n\n// Your pipeline execution will now export traces to Jaeger/Zipkin\n'})}),"\n",(0,r.jsx)(i.h3,{id:"jaeger-example",children:"Jaeger Example"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:'# Start a local Jaeger instance\ndocker run -p 4317:4317 -p 16686:16686 jaegertracing/jaeger:latest\n\n# In your application\nusing var tracerProvider = new TracerProviderBuilder()\n    .AddSource("MyPipeline")\n    .AddOtlpExporter(opt =>\n    {\n        opt.Endpoint = new Uri("http://localhost:4317");\n    })\n    .Build();\n'})}),"\n",(0,r.jsxs)(i.p,{children:["Then visit ",(0,r.jsx)(i.code,{children:"http://localhost:16686"})," to view traces."]}),"\n",(0,r.jsx)(i.h2,{id:"activity-hierarchies",children:"Activity Hierarchies"}),"\n",(0,r.jsx)(i.p,{children:"Activities can be nested to represent hierarchical execution:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:'public class HierarchicalTracer : IPipelineTracer\n{\n    public IPipelineActivity StartActivity(string name)\n    {\n        // Activities automatically parent to the current Activity\n        var activity = new Activity($"Pipeline.{name}")\n            .Start();\n\n        if (activity != null)\n        {\n            activity.SetTag("trace_id", activity.TraceId);\n            activity.SetTag("span_id", activity.SpanId);\n            return new PipelineActivity(activity);\n        }\n\n        return new NullPipelineActivity();\n    }\n}\n'})}),"\n",(0,r.jsx)(i.p,{children:"Parent-child relationships are established automatically:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["When a new activity is started, it becomes a child of ",(0,r.jsx)(i.code,{children:"Activity.Current"})]}),"\n",(0,r.jsx)(i.li,{children:"The trace ID is propagated to all child activities"}),"\n",(0,r.jsx)(i.li,{children:"Span IDs create the parent-child hierarchy"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"testing-activities",children:"Testing Activities"}),"\n",(0,r.jsxs)(i.p,{children:["When testing, use ",(0,r.jsx)(i.code,{children:"NullPipelineActivity"})," to avoid side effects:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",children:"[Fact]\npublic void ProcessNode_ShouldCompleteSuccessfully()\n{\n    // Use null activity for testing\n    var activity = new NullPipelineActivity();\n    \n    var context = new PipelineContext(\n        PipelineContextConfiguration.WithObservability(\n            tracer: new NullPipelineTracer()\n        )\n    );\n\n    // Test your pipeline without actual tracing overhead\n    await runner.RunAsync<MyPipeline>(context);\n}\n"})}),"\n",(0,r.jsx)(i.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Use meaningful activity names"}),": Name activities after the node or operation they represent"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Tag early and often"}),": Add tags throughout the execution, not just at the end"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Record all exceptions"}),": Ensure error paths are traced for debugging"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Keep tags lightweight"}),": Avoid recording large objects; use summaries instead"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Implement the tracer pattern"}),": Create a reusable tracer implementation for your organization"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Use correlation IDs"}),": Include correlation or request IDs in tags for cross-service tracing"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Monitor trace volume"}),": Large pipelines with fine-grained tracing can generate significant trace data"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"see-also",children:"See Also"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/docs/extensions/observability/metrics",children:"Metrics Collection"}),": Learn about performance metrics collection"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/docs/extensions/observability/configuration",children:"Configuration Guide"}),": Configure observability settings"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"https://opentelemetry.io/",children:"OpenTelemetry Documentation"}),": Learn about OpenTelemetry standards"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);