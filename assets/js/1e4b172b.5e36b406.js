"use strict";(self.webpackChunknpipeline=self.webpackChunknpipeline||[]).push([[8059],{4681:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"core-concepts/grouping-strategies","title":"Grouping Strategies - Batching vs Aggregation","description":"Understand the critical distinction between batching and aggregation, and choose the right approach for your data processing needs.","source":"@site/docs/core-concepts/grouping-strategies.md","sourceDirName":"core-concepts","slug":"/core-concepts/grouping-strategies","permalink":"/npipeline.dev/docs/core-concepts/grouping-strategies","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Grouping Strategies - Batching vs Aggregation","description":"Understand the critical distinction between batching and aggregation, and choose the right approach for your data processing needs.","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Data Pipes (IDataPipe)","permalink":"/npipeline.dev/docs/core-concepts/data-pipes"},"next":{"title":"INode and its Derivatives","permalink":"/npipeline.dev/docs/core-concepts/inode"}}');var t=s(4848),r=s(8453);const o={title:"Grouping Strategies - Batching vs Aggregation",description:"Understand the critical distinction between batching and aggregation, and choose the right approach for your data processing needs.",sidebar_position:3},a=void 0,c={},d=[{value:"Grouping Strategies: Batching vs Aggregation",id:"grouping-strategies-batching-vs-aggregation",level:2},{value:"The Core Distinction",id:"the-core-distinction",level:2},{value:"Batching: Operational Efficiency",id:"batching-operational-efficiency",level:3},{value:"Aggregation: Data Correctness",id:"aggregation-data-correctness",level:3},{value:"Side-by-Side Comparison",id:"side-by-side-comparison",level:2},{value:"Decision Framework: Which Should You Use?",id:"decision-framework-which-should-you-use",level:2},{value:"Decision Path 1: &quot;To Reduce Load on External Systems&quot;",id:"decision-path-1-to-reduce-load-on-external-systems",level:3},{value:"Decision Path 2: &quot;To Ensure Correctness with Late or Out-of-Order Data&quot;",id:"decision-path-2-to-ensure-correctness-with-late-or-out-of-order-data",level:3},{value:"Consequences of Choosing Wrong",id:"consequences-of-choosing-wrong",level:2},{value:"\u274c Using Batching When You Need Aggregation",id:"-using-batching-when-you-need-aggregation",level:3},{value:"\u274c Using Aggregation When You Need Batching",id:"-using-aggregation-when-you-need-batching",level:3},{value:"Quick Reference: Configuration Checklist",id:"quick-reference-configuration-checklist",level:2},{value:"Choosing Batching",id:"choosing-batching",level:3},{value:"Choosing Aggregation",id:"choosing-aggregation",level:3},{value:"When You Need Both",id:"when-you-need-both",level:2},{value:"\u27a1\ufe0f Next Steps",id:"arrow_right-next-steps",level:2}];function l(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"grouping-strategies-batching-vs-aggregation",children:"Grouping Strategies: Batching vs Aggregation"}),"\n",(0,t.jsxs)(n.p,{children:["When building data pipelines, you often need to group items together. NPipeline provides two fundamentally different approaches\u2014",(0,t.jsx)(n.strong,{children:"batching"})," and ",(0,t.jsx)(n.strong,{children:"aggregation"}),"\u2014each suited for solving different problems."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"This decision is critical."})," Choosing the wrong approach can lead to:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Subtle data corruption"})," (wrong results, not crashes)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Performance bottlenecks"})," (unnecessary complexity)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Silent failures"})," (pipeline runs fine, but data is incorrect)"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Understanding this distinction upfront prevents these problems."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"the-core-distinction",children:"The Core Distinction"}),"\n",(0,t.jsx)(n.h3,{id:"batching-operational-efficiency",children:"Batching: Operational Efficiency"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose:"})," Group items to meet external system constraints and improve performance."]}),"\n",(0,t.jsxs)(n.p,{children:["Batching solves an ",(0,t.jsx)(n.strong,{children:"operational problem"}),": external systems (like databases) work more efficiently when you send them multiple items at once rather than one at a time."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"When to use:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Bulk database inserts (1000 rows at a time vs row-by-row)"}),"\n",(0,t.jsx)(n.li,{children:"Batch API calls (100 records per request vs individual requests)"}),"\n",(0,t.jsx)(n.li,{children:"Writing to files in chunks (filesystem buffers)"}),"\n",(0,t.jsx)(n.li,{children:"Any scenario where the external system requires or prefers batch operations"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Key insight:"})," Batching looks at the ",(0,t.jsx)(n.strong,{children:"wall clock"}),'. It says: "Every N items, or every X seconds, send what we have."']}),"\n",(0,t.jsx)(n.h3,{id:"aggregation-data-correctness",children:"Aggregation: Data Correctness"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Purpose:"})," Group items to ensure correct results when data arrives out of order or late."]}),"\n",(0,t.jsxs)(n.p,{children:["Aggregation solves a ",(0,t.jsx)(n.strong,{children:"correctness problem"}),': in event-driven systems, events often arrive out of sequence or after their logical "window" has passed. Aggregation handles this by maintaining state across events and time windows.']}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"When to use:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Time-windowed summaries (count events per hour)"}),"\n",(0,t.jsx)(n.li,{children:"Handling late-arriving data (events arriving 5+ minutes late)"}),"\n",(0,t.jsx)(n.li,{children:"Deduplication based on event timestamps"}),"\n",(0,t.jsxs)(n.li,{children:["Any scenario where the ",(0,t.jsx)(n.strong,{children:"order and timing of data matters"})," for correctness"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Key insight:"})," Aggregation uses a ",(0,t.jsx)(n.strong,{children:"time machine"}),'. It says: "Group events by their ',(0,t.jsx)(n.em,{children:"event time"}),', not when they arrived, and wait for latecomers."']}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"side-by-side-comparison",children:"Side-by-Side Comparison"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Aspect"}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Batching"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Aggregation"})})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Primary Problem Solved"})}),(0,t.jsx)(n.td,{children:"External system efficiency"}),(0,t.jsx)(n.td,{children:"Data correctness"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Groups By"})}),(0,t.jsx)(n.td,{children:"Container size or elapsed time"}),(0,t.jsx)(n.td,{children:"Time windows, keys, event time"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Handles Late Data"})}),(0,t.jsx)(n.td,{children:"No (arrives late = arrives late)"}),(0,t.jsx)(n.td,{children:"Yes (configured grace period)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"State Complexity"})}),(0,t.jsx)(n.td,{children:"Simple (current batch buffer)"}),(0,t.jsx)(n.td,{children:"Complex (windowed state, watermarks)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Configuration"})}),(0,t.jsx)(n.td,{children:"Batch size, timeout"}),(0,t.jsx)(n.td,{children:"Window size, window type, max lateness"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"When It Fails"})}),(0,t.jsx)(n.td,{children:"Entire batch fails (transactional)"}),(0,t.jsx)(n.td,{children:"Only events in affected window fail"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Real-World Example"})}),(0,t.jsx)(n.td,{children:'"I need to insert 1000 rows at a time for DB performance"'}),(0,t.jsx)(n.td,{children:'"I need to count events per hour, but events may arrive 5 minutes late"'})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Architectural Signal"})}),(0,t.jsx)(n.td,{children:"Simple config = operational efficiency focus"}),(0,t.jsx)(n.td,{children:"Complex config = correctness focus"})]})]})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"decision-framework-which-should-you-use",children:"Decision Framework: Which Should You Use?"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Start with this question: Why do I need to group items together?"})}),"\n",(0,t.jsx)(n.h3,{id:"decision-path-1-to-reduce-load-on-external-systems",children:'Decision Path 1: "To Reduce Load on External Systems"'}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'Question: Do you need to meet external system constraints?\r\n- "I need to batch database inserts for performance"\r\n- "My API requires multiple records per request"\r\n- "The file system works better with chunked writes"\r\n\r\nAnswer: Use BATCHING \u2713\r\n\r\nConfiguration:\r\n  - Batch size: ~1000 (adjust based on system limits)\r\n  - Batch timeout: 30 seconds (or your SLA requirement)\r\n  - Error handling: Entire batch fails together (transactional)\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'var batchNode = builder\r\n    .AddBatch<Order, OrderBatch>("bulkInsert")\r\n    .WithBatchSize(1000)\r\n    .WithBatchTimeout(TimeSpan.FromSeconds(30));\n'})}),"\n",(0,t.jsx)(n.h3,{id:"decision-path-2-to-ensure-correctness-with-late-or-out-of-order-data",children:'Decision Path 2: "To Ensure Correctness with Late or Out-of-Order Data"'}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:'Question: Do events arrive out of order or late?\r\n- "I need to count events per hour (events may be 5 mins late)"\r\n- "I need deduplication based on event timestamp"\r\n- "Different event sources have clock skew"\r\n\r\nAnswer: Use AGGREGATION \u2713\r\n\r\nConfiguration:\r\n  - Window type: Tumbling, sliding, or session\r\n  - Window duration: 1 hour (or your business window)\r\n  - Max lateness: 5 minutes (your allowed grace period)\r\n  - Timestamp extractor: How to get event time from items\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'var aggregateNode = builder\r\n    .AddAggregate<Event, PerHourStats>("hourlyStats")\r\n    .WithTumblingWindow(TimeSpan.FromHours(1))\r\n    .WithMaxLateness(TimeSpan.FromMinutes(5))\r\n    .WithEventTimeExtractor(e => e.Timestamp);\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"consequences-of-choosing-wrong",children:"Consequences of Choosing Wrong"}),"\n",(0,t.jsx)(n.h3,{id:"-using-batching-when-you-need-aggregation",children:"\u274c Using Batching When You Need Aggregation"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Scenario:"})," You use batching to group events into hourly buckets."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'// WRONG: Treating time windows as batches\r\nvar badNode = builder\r\n    .AddBatch<Event, EventBatch>("hourlyStats")\r\n    .WithBatchSize(3600); // Process 3600 items at a time\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"What goes wrong:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Events arriving 5 minutes late are ",(0,t.jsx)(n.strong,{children:"already in a different batch"})]}),"\n",(0,t.jsxs)(n.li,{children:["Results are ",(0,t.jsx)(n.strong,{children:"silently incomplete"}),"\u2014no error, no crash, just wrong data"]}),"\n",(0,t.jsxs)(n.li,{children:["Late events might join the ",(0,t.jsx)(n.em,{children:"next"})," batch, corrupting its results"]}),"\n",(0,t.jsx)(n.li,{children:"A developer's nightmare: pipeline runs fine, but analytics are wrong"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"-using-aggregation-when-you-need-batching",children:"\u274c Using Aggregation When You Need Batching"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Scenario:"})," You use aggregation for bulk database inserts."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'// WRONG: Over-engineered batching\r\nvar badNode = builder\r\n    .AddAggregate<OrderInsert, InsertedOrders>("dbInserts")\r\n    .WithTumblingWindow(TimeSpan.FromSeconds(30))\r\n    .WithEventTimeExtractor(o => o.CreatedTime);\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"What goes wrong:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Unnecessary complexity:"})," You're maintaining windowed state for something that doesn't need it"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Resource waste:"})," Memory overhead for aggregation buffers"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Unpredictable latency:"})," A batch of 999 items might wait up to 30 seconds for window closure"]}),"\n",(0,t.jsx)(n.li,{children:"Simple problem, over-engineered solution"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"quick-reference-configuration-checklist",children:"Quick Reference: Configuration Checklist"}),"\n",(0,t.jsx)(n.h3,{id:"choosing-batching",children:"Choosing Batching"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","External system requires/prefers batch operations"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Order/timing of items doesn't affect correctness"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Simple timeout + size trigger is sufficient"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Transactional failure mode is acceptable (all or nothing)"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Configure:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:".WithBatchSize(N)\r\n.WithBatchTimeout(TimeSpan.FromSeconds(X))\n"})}),"\n",(0,t.jsx)(n.h3,{id:"choosing-aggregation",children:"Choosing Aggregation"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Events can arrive out of order or late"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Results are time-windowed or event-time dependent"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","You need to handle ",(0,t.jsx)(n.strong,{children:"event time"})," (not arrival time)"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","You can tolerate the memory cost of state buffers"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Configure:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:".WithTumblingWindow(TimeSpan.FromHours(1))\r\n.WithMaxLateness(TimeSpan.FromMinutes(5))\r\n.WithEventTimeExtractor(x => x.Timestamp)\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"when-you-need-both",children:"When You Need Both"}),"\n",(0,t.jsxs)(n.p,{children:["Some pipelines use ",(0,t.jsx)(n.strong,{children:"both strategies in sequence"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"Sources\r\n  \u2193\r\nAggregation (group by event time)  \u2190 Handle late data, correctness\r\n  \u2193\r\nBatching (group by container size) \u2190 Feed external systems efficiently\r\n  \u2193\r\nSinks\n"})}),"\n",(0,t.jsx)(n.p,{children:"This is perfectly valid. For example:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Aggregation:"})," Group clickstream events into hourly windows (event time)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Batching:"})," Batch the aggregated results (1000 at a time) for bulk database insert"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The key: each node solves one problem, and you compose them."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsxs)(n.h2,{id:"arrow_right-next-steps",children:["\u27a1\ufe0f"," Next Steps"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.a,{href:"/npipeline.dev/docs/core-concepts/advanced-nodes/batching",children:"Batching Nodes"}),":"]})," Deep dive into batching configuration and patterns"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.a,{href:"/npipeline.dev/docs/core-concepts/advanced-nodes/aggregation",children:"Aggregation Nodes"}),":"]})," Master event-time aggregation, windows, and watermarks"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsxs)(n.strong,{children:[(0,t.jsx)(n.a,{href:"/npipeline.dev/docs/core-concepts/common-patterns",children:"Common Patterns"}),":"]})," Real-world examples of grouping in production pipelines"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var i=s(6540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);