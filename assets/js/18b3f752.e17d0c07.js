"use strict";(self.webpackChunknpipeline=self.webpackChunknpipeline||[]).push([[5189],{2569:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"architecture/dependency-injection","title":"Dependency Injection Integration","description":"How NPipeline integrates with dependency injection containers.","source":"@site/docs/architecture/dependency-injection.md","sourceDirName":"architecture","slug":"/architecture/dependency-injection","permalink":"/docs/architecture/dependency-injection","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Dependency Injection Integration","description":"How NPipeline integrates with dependency injection containers.","sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"Data Flow Details","permalink":"/docs/architecture/data-flow"},"next":{"title":"Error Handling Architecture","permalink":"/docs/architecture/error-handling-architecture"}}');var c=r(4848),t=r(8453);const o={title:"Dependency Injection Integration",description:"How NPipeline integrates with dependency injection containers.",sidebar_position:5},s="Dependency Injection Integration",a={},d=[{value:"Automatic Node Resolution",id:"automatic-node-resolution",level:2},{value:"DI Container Integration",id:"di-container-integration",level:2},{value:"Scoped Dependencies",id:"scoped-dependencies",level:2},{value:"Advanced Pattern: Composite Services",id:"advanced-pattern-composite-services",level:2},{value:"Benefits",id:"benefits",level:2},{value:"\u27a1\ufe0f Next Steps",id:"arrow_right-next-steps",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"dependency-injection-integration",children:"Dependency Injection Integration"})}),"\n",(0,c.jsx)(n.p,{children:"NPipeline integrates seamlessly with dependency injection (DI) containers, allowing you to use constructor injection for node dependencies."}),"\n",(0,c.jsx)(n.h2,{id:"automatic-node-resolution",children:"Automatic Node Resolution"}),"\n",(0,c.jsx)(n.p,{children:"When you add a node to a pipeline, NPipeline automatically:"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Creates an instance of the node"}),"\n",(0,c.jsx)(n.li,{children:"Resolves all constructor dependencies from the DI container"}),"\n",(0,c.jsx)(n.li,{children:"Injects them into the node"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"You can also pre-configure node instances for advanced scenarios:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:"// Pre-configure a specific node instance\r\nvar customTransform = new MyTransform(specialConfig);\r\nvar builder = new PipelineBuilder();\r\nbuilder.AddTransformNode(customTransform); // Use the pre-configured instance\n"})}),"\n",(0,c.jsx)(n.p,{children:"This is useful when:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"Node setup is complex and can't be done through DI alone"}),"\n",(0,c.jsx)(n.li,{children:"You need to share state between multiple nodes"}),"\n",(0,c.jsx)(n.li,{children:"You're migrating legacy code"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Example:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:'public class ProcessOrderTransform : ITransformNode<Order, ProcessedOrder>\r\n{\r\n    private readonly IPaymentService _paymentService;\r\n    private readonly INotificationService _notificationService;\r\n\r\n    // Constructor dependencies are automatically injected!\r\n    public ProcessOrderTransform(\r\n        IPaymentService paymentService,\r\n        INotificationService notificationService)\r\n    {\r\n        _paymentService = paymentService;\r\n        _notificationService = notificationService;\r\n    }\r\n\r\n    public async Task<ProcessedOrder> ExecuteAsync(\r\n        Order input,\r\n        PipelineContext context,\r\n        CancellationToken cancellationToken)\r\n    {\r\n        var paymentResult = await _paymentService.ChargeAsync(input.Amount, cancellationToken);\r\n        await _notificationService.SendAsync($"Payment: {paymentResult.Status}", cancellationToken);\r\n        return new ProcessedOrder { /* ... */ };\r\n    }\r\n}\n'})}),"\n",(0,c.jsx)(n.h2,{id:"di-container-integration",children:"DI Container Integration"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Setting Up with Microsoft.Extensions.DependencyInjection:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:"var services = new ServiceCollection();\r\n\r\n// Register your dependencies\r\nservices.AddScoped<IPaymentService, PaymentService>();\r\nservices.AddScoped<INotificationService, NotificationService>();\r\nservices.AddScoped<IOrderRepository, OrderRepository>();\r\n\r\nvar serviceProvider = services.BuildServiceProvider();\r\n\r\n// Pipeline builder uses the service provider\r\nvar pipeline = PipelineBuilder.WithServiceProvider(serviceProvider)\r\n    .AddSourceNode<OrderSourceNode>()\r\n    .AddTransformNode<ProcessOrderTransform>()\r\n    .AddTransformNode<ValidateOrderTransform>()\r\n    .AddSinkNode<OrderSinkNode>()\r\n    .BuildPipeline();\r\n\r\nvar context = PipelineContext.Default;\r\nvar result = await runner.ExecuteAsync(pipeline, context);\n"})}),"\n",(0,c.jsx)(n.h2,{id:"scoped-dependencies",children:"Scoped Dependencies"}),"\n",(0,c.jsx)(n.p,{children:"Each pipeline execution can have its own scope for scoped dependencies:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:"using (var scope = serviceProvider.CreateScope())\r\n{\r\n    var scopedServices = scope.ServiceProvider;\r\n    \r\n    var pipeline = PipelineBuilder.WithServiceProvider(scopedServices)\r\n        .AddSourceNode<OrderSourceNode>()\r\n        .AddTransformNode<ProcessOrderTransform>()\r\n        .AddSinkNode<OrderSinkNode>()\r\n        .BuildPipeline();\r\n\r\n    await runner.ExecuteAsync(pipeline, context);\r\n    // Scoped services are disposed here\r\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"advanced-pattern-composite-services",children:"Advanced Pattern: Composite Services"}),"\n",(0,c.jsx)(n.p,{children:"Use DI to compose complex behavior:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:"public class EnrichedOrderTransform : ITransformNode<Order, EnrichedOrder>\r\n{\r\n    private readonly IOrderEnricher _enricher;\r\n    private readonly ICacheService _cache;\r\n\r\n    public EnrichedOrderTransform(\r\n        IOrderEnricher enricher,\r\n        ICacheService cache)\r\n    {\r\n        _enricher = enricher;\r\n        _cache = cache;\r\n    }\r\n\r\n    public async Task<EnrichedOrder> ExecuteAsync(\r\n        Order input,\r\n        PipelineContext context,\r\n        CancellationToken cancellationToken)\r\n    {\r\n        var cached = await _cache.GetAsync(input.Id, cancellationToken);\r\n        if (cached != null)\r\n            return cached;\r\n\r\n        var enriched = await _enricher.EnrichAsync(input, cancellationToken);\r\n        await _cache.SetAsync(input.Id, enriched, cancellationToken);\r\n        return enriched;\r\n    }\r\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"benefits",children:"Benefits"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Testability:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:"// Test with mock dependencies\r\nvar mockPaymentService = new Mock<IPaymentService>();\r\nvar mockNotificationService = new Mock<INotificationService>();\r\n\r\nvar transform = new ProcessOrderTransform(\r\n    mockPaymentService.Object,\r\n    mockNotificationService.Object);\r\n\r\n// Test the transform in isolation\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"Flexibility:"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-csharp",children:"// Swap implementations based on environment\r\nif (isDevelopment)\r\n{\r\n    services.AddSingleton<IPaymentService, MockPaymentService>();\r\n}\r\nelse\r\n{\r\n    services.AddSingleton<IPaymentService, StripePaymentService>();\r\n}\n"})}),"\n",(0,c.jsxs)(n.h2,{id:"arrow_right-next-steps",children:["\u27a1\ufe0f"," Next Steps"]}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.a,{href:"/docs/architecture/error-handling-architecture",children:"Error Handling Architecture"})})," - Learn how DI works with error handlers"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.a,{href:"/docs/architecture/extension-points",children:"Extension Points"})})," - Create custom nodes with DI support"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>s});var i=r(6540);const c={},t=i.createContext(c);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);