"use strict";(self.webpackChunknpipeline=self.webpackChunknpipeline||[]).push([[6562],{8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var t=i(6540);const r={},a=t.createContext(r);function o(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(a.Provider,{value:n},e.children)}},8484:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"core-concepts/nodes/sink-nodes","title":"Sink Nodes","description":"Learn how to implement sink nodes that consume and finalize data at the end of your pipeline.","source":"@site/docs/core-concepts/nodes/sink-nodes.md","sourceDirName":"core-concepts/nodes","slug":"/core-concepts/nodes/sink-nodes","permalink":"/npipeline.dev/docs/core-concepts/nodes/sink-nodes","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Sink Nodes","description":"Learn how to implement sink nodes that consume and finalize data at the end of your pipeline.","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Transform Nodes","permalink":"/npipeline.dev/docs/core-concepts/nodes/transform-nodes"},"next":{"title":"Resilience Overview","permalink":"/npipeline.dev/docs/core-concepts/resilience/"}}');var r=i(4848),a=i(8453);const o={title:"Sink Nodes",description:"Learn how to implement sink nodes that consume and finalize data at the end of your pipeline.",sidebar_position:3},c="Sink Nodes (ISinkNode<TIn>)",s={},l=[{value:"Interface Definition",id:"interface-definition",level:2},{value:"Implementation Example",id:"implementation-example",level:2},{value:"Key Concepts",id:"key-concepts",level:2},{value:"Data Pipe Consumption",id:"data-pipe-consumption",level:3},{value:"Streaming Iteration",id:"streaming-iteration",level:3},{value:"Activity Tracking",id:"activity-tracking",level:3},{value:"Graceful Shutdown",id:"graceful-shutdown",level:3},{value:"Common Sink Patterns",id:"common-sink-patterns",level:2},{value:"Database Write Sink",id:"database-write-sink",level:3},{value:"File Write Sink",id:"file-write-sink",level:3},{value:"HTTP Request Sink",id:"http-request-sink",level:3},{value:"Aggregating Sink (Collect Results)",id:"aggregating-sink-collect-results",level:3},{value:"Metric Collection Sink",id:"metric-collection-sink",level:3},{value:"\u27a1\ufe0f Next Steps",id:"arrow_right-next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsxs)(n.h1,{id:"sink-nodes-isinknodetin",children:["Sink Nodes (",(0,r.jsx)(n.code,{children:"ISinkNode<TIn>"}),")"]})}),"\n",(0,r.jsxs)(n.p,{children:["Sink nodes are the terminal points of a pipeline. They consume the final processed data stream (",(0,r.jsx)(n.code,{children:"TInput"}),") and typically perform an action such as writing to a database, sending a notification, or displaying results. Sink nodes do not produce any output."]}),"\n",(0,r.jsx)(n.h2,{id:"interface-definition",children:"Interface Definition"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public interface ISinkNode<TIn> : INode\r\n{\r\n    Task ExecuteAsync(IDataPipe<TIn> input, PipelineContext context, CancellationToken cancellationToken);\r\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"implementation-example",children:"Implementation Example"}),"\n",(0,r.jsx)(n.p,{children:"A sink that prints each incoming number to the console:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'using NPipeline;\r\nusing NPipeline.DataFlow;\r\nusing NPipeline.Nodes;\r\nusing NPipeline.Observability.Tracing;\r\nusing NPipeline.Pipeline;\r\n\r\npublic sealed class ConsoleSink<T> : ISinkNode<T>\r\n{\r\n    public async Task ExecuteAsync(IDataPipe<T> input, PipelineContext context, CancellationToken cancellationToken)\r\n    {\r\n        await foreach (var item in input.WithCancellation(cancellationToken))\r\n        {\r\n            Console.WriteLine($"Sink received: {item}");\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"key-concepts",children:"Key Concepts"}),"\n",(0,r.jsx)(n.h3,{id:"data-pipe-consumption",children:"Data Pipe Consumption"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"ExecuteAsync"})," method receives an ",(0,r.jsx)(n.code,{children:"IDataPipe<TIn>"})," which represents the final stream of items produced by the previous node in the pipeline. Sink nodes iterate through this stream and perform appropriate operations."]}),"\n",(0,r.jsx)(n.h3,{id:"streaming-iteration",children:"Streaming Iteration"}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"await foreach"})," to asynchronously iterate through the data pipe. This pattern allows efficient memory usage\u2014items are processed as they arrive rather than being buffered in memory."]}),"\n",(0,r.jsx)(n.h3,{id:"activity-tracking",children:"Activity Tracking"}),"\n",(0,r.jsxs)(n.p,{children:["To access tracing and observability information, use the ",(0,r.jsx)(n.code,{children:"PipelineContext"})," parameter. You can access the current activity through ",(0,r.jsx)(n.code,{children:"context.Tracer.CurrentActivity"}),", which returns the active tracing span if one exists, or ",(0,r.jsx)(n.code,{children:"null"})," if tracing is disabled."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'public async Task ExecuteAsync(IDataPipe<T> input, PipelineContext context, CancellationToken cancellationToken)\r\n{\r\n    var activity = context.Tracer.CurrentActivity;\r\n    if (activity != null)\r\n    {\r\n        // Access tracing metadata, emit logs, track metrics\r\n        await activity.EmitEventAsync("Processing started", cancellationToken);\r\n    }\r\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"graceful-shutdown",children:"Graceful Shutdown"}),"\n",(0,r.jsxs)(n.p,{children:["Always respect the ",(0,r.jsx)(n.code,{children:"cancellationToken"})," parameter to allow graceful shutdown of your pipeline. This is especially important for long-running sinks or those that interact with external systems."]}),"\n",(0,r.jsx)(n.h2,{id:"common-sink-patterns",children:"Common Sink Patterns"}),"\n",(0,r.jsx)(n.h3,{id:"database-write-sink",children:"Database Write Sink"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'public sealed class DatabaseWriteSink : ISinkNode<CustomerRecord>\r\n{\r\n    private readonly string _connectionString;\r\n\r\n    public DatabaseWriteSink(string connectionString)\r\n    {\r\n        _connectionString = connectionString;\r\n    }\r\n\r\n    public async Task ExecuteAsync(IDataPipe<CustomerRecord> input, PipelineContext context, CancellationToken cancellationToken)\r\n    {\r\n        using (var connection = new SqlConnection(_connectionString))\r\n        {\r\n            await connection.OpenAsync(cancellationToken);\r\n\r\n            await foreach (var record in input.WithCancellation(cancellationToken))\r\n            {\r\n                using (var command = new SqlCommand("INSERT INTO Customers (Id, Name, Email) VALUES (@id, @name, @email)", connection))\r\n                {\r\n                    command.Parameters.AddWithValue("@id", record.Id);\r\n                    command.Parameters.AddWithValue("@name", record.Name);\r\n                    command.Parameters.AddWithValue("@email", record.Email);\r\n\r\n                    await command.ExecuteNonQueryAsync(cancellationToken);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"file-write-sink",children:"File Write Sink"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public sealed class FileWriteSink : ISinkNode<string>\r\n{\r\n    private readonly string _filePath;\r\n\r\n    public FileWriteSink(string filePath)\r\n    {\r\n        _filePath = filePath;\r\n    }\r\n\r\n    public async Task ExecuteAsync(IDataPipe<string> input, PipelineContext context, CancellationToken cancellationToken)\r\n    {\r\n        using (var writer = new StreamWriter(_filePath, append: false))\r\n        {\r\n            await foreach (var line in input.WithCancellation(cancellationToken))\r\n            {\r\n                await writer.WriteLineAsync(line);\r\n            }\r\n        }\r\n    }\r\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"http-request-sink",children:"HTTP Request Sink"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'public sealed class HttpPostSink : ISinkNode<DataRecord>\r\n{\r\n    private readonly string _endpoint;\r\n    private readonly HttpClient _httpClient;\r\n\r\n    public HttpPostSink(string endpoint)\r\n    {\r\n        _endpoint = endpoint;\r\n        _httpClient = new HttpClient();\r\n    }\r\n\r\n    public async Task ExecuteAsync(IDataPipe<DataRecord> input, PipelineContext context, CancellationToken cancellationToken)\r\n    {\r\n        await foreach (var record in input.WithCancellation(cancellationToken))\r\n        {\r\n            var json = JsonSerializer.Serialize(record);\r\n            var content = new StringContent(json, Encoding.UTF8, "application/json");\r\n\r\n            var response = await _httpClient.PostAsync(_endpoint, content, cancellationToken);\r\n            response.EnsureSuccessStatusCode();\r\n        }\r\n    }\r\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"aggregating-sink-collect-results",children:"Aggregating Sink (Collect Results)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public sealed class CollectingSink : ISinkNode<int>\r\n{\r\n    public List<int> Results { get; } = new();\r\n\r\n    public async Task ExecuteAsync(IDataPipe<int> input, PipelineContext context, CancellationToken cancellationToken)\r\n    {\r\n        await foreach (var item in input.WithCancellation(cancellationToken))\r\n        {\r\n            Results.Add(item);\r\n        }\r\n    }\r\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"metric-collection-sink",children:"Metric Collection Sink"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public sealed class MetricsSink : ISinkNode<ProcessedEvent>\r\n{\r\n    private int _totalProcessed = 0;\r\n    private int _totalErrors = 0;\r\n\r\n    public int TotalProcessed => _totalProcessed;\r\n    public int TotalErrors => _totalErrors;\r\n\r\n    public async Task ExecuteAsync(IDataPipe<ProcessedEvent> input, PipelineContext context, CancellationToken cancellationToken)\r\n    {\r\n        await foreach (var @event in input.WithCancellation(cancellationToken))\r\n        {\r\n            if (@event.IsError)\r\n            {\r\n                Interlocked.Increment(ref _totalErrors);\r\n            }\r\n            else\r\n            {\r\n                Interlocked.Increment(ref _totalProcessed);\r\n            }\r\n        }\r\n    }\r\n}\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"arrow_right-next-steps",children:["\u27a1\ufe0f"," Next Steps"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/npipeline.dev/docs/core-concepts/advanced-nodes",children:"Advanced Node Types"})}),": Explore sophisticated patterns like aggregation and batching"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"/npipeline.dev/docs/core-concepts/pipeline-execution",children:"Pipeline Execution"})}),": Learn how pipelines execute and handle errors"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);