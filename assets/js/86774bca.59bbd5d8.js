"use strict";(self.webpackChunknpipeline=self.webpackChunknpipeline||[]).push([[4709],{462:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"architecture/extension-points","title":"Extension Points","description":"Customization mechanisms in NPipeline.","source":"@site/docs/architecture/extension-points.md","sourceDirName":"architecture","slug":"/architecture/extension-points","permalink":"/docs/architecture/extension-points","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"title":"Extension Points","description":"Customization mechanisms in NPipeline.","sidebar_position":9},"sidebar":"docsSidebar","previous":{"title":"Retry Delay Strategies Architecture","permalink":"/docs/architecture/retry-delay-architecture"},"next":{"title":"Design Principles","permalink":"/docs/architecture/design-principles"}}');var t=r(4848),s=r(8453);const o={title:"Extension Points",description:"Customization mechanisms in NPipeline.",sidebar_position:9},a="Extension Points",c={},l=[{value:"Custom Nodes",id:"custom-nodes",level:2},{value:"Build-Time Roslyn Analyzers",id:"build-time-roslyn-analyzers",level:2},{value:"Custom Execution Strategies",id:"custom-execution-strategies",level:2},{value:"Context Data",id:"context-data",level:2},{value:"Diagnostic Observers",id:"diagnostic-observers",level:2},{value:"Composite Patterns",id:"composite-patterns",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"extension-points",children:"Extension Points"})}),"\n",(0,t.jsx)(n.p,{children:"NPipeline provides multiple ways to extend and customize its behavior without modifying the core framework."}),"\n",(0,t.jsx)(n.h2,{id:"custom-nodes",children:"Custom Nodes"}),"\n",(0,t.jsx)(n.p,{children:"Build your own source, transform, or sink nodes:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'// Custom Source\r\npublic class DatabaseSourceNode : ISourceNode<Order>\r\n{\r\n    private readonly string _connectionString;\r\n\r\n    public DatabaseSourceNode(string connectionString)\r\n    {\r\n        _connectionString = connectionString;\r\n    }\r\n\r\n    public IDataPipe<Order> Initialize(\r\n        PipelineContext context,\r\n        CancellationToken cancellationToken = default)\r\n    {\r\n        async IAsyncEnumerable<Order> StreamOrders(\r\n            [EnumeratorCancellation] CancellationToken ct)\r\n        {\r\n            using var connection = new SqlConnection(_connectionString);\r\n            await connection.OpenAsync(ct);\r\n            \r\n            using var command = new SqlCommand("SELECT * FROM Orders", connection);\r\n            using var reader = await command.ExecuteReaderAsync(ct);\r\n            \r\n            while (await reader.ReadAsync(ct))\r\n            {\r\n                yield return new Order\r\n                {\r\n                    Id = reader.GetInt32(0),\r\n                    Amount = reader.GetDecimal(1),\r\n                    // ...\r\n                };\r\n            }\r\n        }\r\n\r\n        return new StreamingDataPipe<Order>(StreamOrders(cancellationToken), "DatabaseSource");\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"// Custom Transform\r\npublic class EnrichmentTransform : ITransformNode<Order, EnrichedOrder>\r\n{\r\n    private readonly IEnrichmentService _enrichmentService;\r\n\r\n    public EnrichmentTransform(IEnrichmentService enrichmentService)\r\n    {\r\n        _enrichmentService = enrichmentService;\r\n    }\r\n\r\n    public async Task<EnrichedOrder> ExecuteAsync(\r\n        Order input,\r\n        PipelineContext context,\r\n        CancellationToken cancellationToken)\r\n    {\r\n        var enrichedData = await _enrichmentService.EnrichAsync(input, cancellationToken);\r\n        return new EnrichedOrder\r\n        {\r\n            Order = input,\r\n            EnrichedData = enrichedData\r\n        };\r\n    }\r\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"// Custom Sink\r\npublic class MetricsCollectorSink : ISinkNode<Result>\r\n{\r\n    private readonly IMetricsCollector _metrics;\r\n\r\n    public MetricsCollectorSink(IMetricsCollector metrics)\r\n    {\r\n        _metrics = metrics;\r\n    }\r\n\r\n    public async Task ExecuteAsync(\r\n        IDataPipe<Result> input,\r\n        PipelineContext context,\r\n        CancellationToken cancellationToken)\r\n    {\r\n        var activity = context.Tracer.CurrentActivity;\r\n        \r\n        await foreach (var result in input.WithCancellation(cancellationToken))\r\n        {\r\n            _metrics.RecordSuccess(result.ProcessingTimeMs);\r\n            await Task.Delay(100); // Simulate processing\r\n        }\r\n    }\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"build-time-roslyn-analyzers",children:"Build-Time Roslyn Analyzers"}),"\n",(0,t.jsx)(n.p,{children:"NPipeline includes built-in Roslyn analyzers that provide compile-time validation of your pipeline configurations. These analyzers detect common mistakes before they reach production."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Key Analyzer:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"NP9002"})," - Detects incomplete resilience configurations where ",(0,t.jsx)(n.code,{children:"RestartNode"})," is used without required prerequisites"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The analyzer framework is designed to be extensible, allowing community contributions of additional analyzers for NPipeline-specific patterns."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Learn more:"})," ",(0,t.jsx)(n.a,{href:"/docs/tooling/analyzers/resilience",children:"Build-Time Resilience Analyzer Guide"})]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"custom-execution-strategies",children:"Custom Execution Strategies"}),"\n",(0,t.jsx)(n.p,{children:"Create custom node execution strategies:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"public class ThrottledExecutionStrategy : INodeExecutionStrategy\r\n{\r\n    private readonly int _maxConcurrent;\r\n    private readonly SemaphoreSlim _semaphore;\r\n\r\n    public ThrottledExecutionStrategy(int maxConcurrent)\r\n    {\r\n        _maxConcurrent = maxConcurrent;\r\n        _semaphore = new SemaphoreSlim(maxConcurrent);\r\n    }\r\n\r\n    public async Task ExecuteAsync(\r\n        Func<CancellationToken, Task> work,\r\n        CancellationToken cancellationToken)\r\n    {\r\n        await _semaphore.WaitAsync(cancellationToken);\r\n        try\r\n        {\r\n            await work(cancellationToken);\r\n        }\r\n        finally\r\n        {\r\n            _semaphore.Release();\r\n        }\r\n    }\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"context-data",children:"Context Data"}),"\n",(0,t.jsx)(n.p,{children:"Store and retrieve arbitrary data in pipeline context:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'// Store data\r\nvar context = PipelineContext.Default;\r\ncontext.Set("startTime", DateTime.UtcNow);\r\ncontext.Set("userId", 12345);\r\ncontext.Set("requestId", Guid.NewGuid());\r\n\r\n// Access in transform\r\npublic async IAsyncEnumerable<Output> ProcessAsync(\r\n    Input input,\r\n    [EnumeratorCancellation] CancellationToken cancellationToken = default)\r\n{\r\n    var startTime = context.Get<DateTime>("startTime");\r\n    var userId = context.Get<int>("userId");\r\n    var requestId = context.Get<Guid>("requestId");\r\n\r\n    yield return new Output\r\n    {\r\n        UserId = userId,\r\n        RequestId = requestId,\r\n        ProcessingTime = DateTime.UtcNow - startTime\r\n    };\r\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"diagnostic-observers",children:"Diagnostic Observers"}),"\n",(0,t.jsx)(n.p,{children:"Observe pipeline execution for diagnostics:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'public class DiagnosticObserver : IPipelineDiagnosticObserver\r\n{\r\n    private readonly ILogger<DiagnosticObserver> _logger;\r\n\r\n    public DiagnosticObserver(ILogger<DiagnosticObserver> logger)\r\n    {\r\n        _logger = logger;\r\n    }\r\n\r\n    public void OnNodeStarted(string nodeName)\r\n    {\r\n        _logger.LogInformation("Node started: {node}", nodeName);\r\n    }\r\n\r\n    public void OnNodeCompleted(string nodeName, int itemsProcessed)\r\n    {\r\n        _logger.LogInformation("Node completed: {node}, items: {count}", nodeName, itemsProcessed);\r\n    }\r\n\r\n    public void OnNodeError(string nodeName, Exception ex)\r\n    {\r\n        _logger.LogError(ex, "Node error: {node}", nodeName);\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"composite-patterns",children:"Composite Patterns"}),"\n",(0,t.jsx)(n.p,{children:"Combine extensions for complex behaviors:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:"public class ResilientTransform : ITransformNode<T, T>\r\n{\r\n    private readonly ITransformNode<T, T> _inner;\r\n    private readonly IRetryPolicy _retryPolicy;\r\n    private readonly IFallbackProvider<T> _fallback;\r\n    private readonly IDiagnostics _diagnostics;\r\n\r\n    public ResilientTransform(\r\n        ITransformNode<T, T> inner,\r\n        IRetryPolicy retryPolicy,\r\n        IFallbackProvider<T> fallback,\r\n        IDiagnostics diagnostics)\r\n    {\r\n        _inner = inner;\r\n        _retryPolicy = retryPolicy;\r\n        _fallback = fallback;\r\n        _diagnostics = diagnostics;\r\n    }\r\n\r\n    public async IAsyncEnumerable<T> ProcessAsync(\r\n        T input,\r\n        [EnumeratorCancellation] CancellationToken cancellationToken = default)\r\n    {\r\n        try\r\n        {\r\n            _diagnostics.LogAttempt(_inner.GetType().Name);\r\n            \r\n            await foreach (var result in _retryPolicy.ExecuteAsync(\r\n                () => _inner.ProcessAsync(input, cancellationToken),\r\n                cancellationToken))\r\n            {\r\n                _diagnostics.LogSuccess(_inner.GetType().Name);\r\n                yield return result;\r\n            }\r\n        }\r\n        catch (Exception ex)\r\n        {\r\n            _diagnostics.LogFailure(_inner.GetType().Name, ex);\r\n            \r\n            var fallback = await _fallback.GetFallbackAsync(input, ex);\r\n            yield return fallback;\r\n        }\r\n    }\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"/docs/architecture/design-principles",children:"Design Principles"})})," - Understand guiding principles for extensions"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"/docs/extensions/testing/advanced-testing",children:"Advanced Testing Pipelines"})})," - Test your custom nodes"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var i=r(6540);const t={},s=i.createContext(t);function o(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);