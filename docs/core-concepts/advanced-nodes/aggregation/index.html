<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-core-concepts/advanced-nodes/aggregation" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Aggregation Nodes | NPipeline</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="robots" content="noindex, nofollow"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://npipeline.dev/docs/core-concepts/advanced-nodes/aggregation"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Aggregation Nodes | NPipeline"><meta data-rh="true" name="description" content="Learn how to perform powerful data aggregations within your NPipeline using specialized nodes."><meta data-rh="true" property="og:description" content="Learn how to perform powerful data aggregations within your NPipeline using specialized nodes."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://npipeline.dev/docs/core-concepts/advanced-nodes/aggregation"><link data-rh="true" rel="alternate" href="https://npipeline.dev/docs/core-concepts/advanced-nodes/aggregation" hreflang="en"><link data-rh="true" rel="alternate" href="https://npipeline.dev/docs/core-concepts/advanced-nodes/aggregation" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Core Concepts","item":"https://npipeline.dev/docs/core-concepts"},{"@type":"ListItem","position":2,"name":"Advanced Nodes","item":"https://npipeline.dev/docs/core-concepts/advanced-nodes"},{"@type":"ListItem","position":3,"name":"Aggregation Nodes","item":"https://npipeline.dev/docs/core-concepts/advanced-nodes/aggregation"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="NPipeline RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="NPipeline Atom Feed"><link rel="stylesheet" href="/assets/css/styles.dcef641c.css">
<script src="/assets/js/runtime~main.6b28dc38.js" defer="defer"></script>
<script src="/assets/js/main.e01f4df8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="NPipeline logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="NPipeline logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">NPipeline</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/npipeline/npipeline" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/"><span title="Welcome to NPipeline" class="linkLabel_WmDU">Welcome to NPipeline</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/introduction"><span title="Introduction" class="categoryLinkLabel_W154">Introduction</span></a><button aria-label="Expand sidebar category &#x27;Introduction&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learning-paths"><span title="Learning Paths" class="linkLabel_WmDU">Learning Paths</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/getting-started"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/docs/core-concepts"><span title="Core Concepts" class="categoryLinkLabel_W154">Core Concepts</span></a><button aria-label="Collapse sidebar category &#x27;Core Concepts&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/grouping-strategies"><span title="Grouping Strategies - Batching vs Aggregation" class="linkLabel_WmDU">Grouping Strategies - Batching vs Aggregation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/ipipeline"><span title="Pipeline" class="linkLabel_WmDU">Pipeline</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/data-pipes"><span title="Data Pipes (IDataPipe)" class="linkLabel_WmDU">Data Pipes (IDataPipe)</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/core-concepts/nodes/"><span title="Nodes" class="categoryLinkLabel_W154">Nodes</span></a><button aria-label="Collapse sidebar category &#x27;Nodes&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/nodes/source-nodes"><span title="Source Nodes" class="linkLabel_WmDU">Source Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/nodes/transform-nodes"><span title="Transform Nodes" class="linkLabel_WmDU">Transform Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/nodes/sink-nodes"><span title="Sink Nodes" class="linkLabel_WmDU">Sink Nodes</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/core-concepts/resilience/"><span title="Resilience" class="categoryLinkLabel_W154">Resilience</span></a><button aria-label="Expand sidebar category &#x27;Resilience&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/core-concepts/advanced-nodes"><span title="Advanced Nodes" class="categoryLinkLabel_W154">Advanced Nodes</span></a><button aria-label="Collapse sidebar category &#x27;Advanced Nodes&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/advanced-nodes/batching"><span title="Batching Nodes" class="linkLabel_WmDU">Batching Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/advanced-nodes/join"><span title="Join Nodes" class="linkLabel_WmDU">Join Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/advanced-nodes/lookup"><span title="Lookup Nodes" class="linkLabel_WmDU">Lookup Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/advanced-nodes/branch"><span title="Branch Nodes" class="linkLabel_WmDU">Branch Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/advanced-nodes/tap"><span title="Tap Nodes" class="linkLabel_WmDU">Tap Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/advanced-nodes/type-conversion"><span title="Type Conversion Nodes" class="linkLabel_WmDU">Type Conversion Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/core-concepts/advanced-nodes/aggregation"><span title="Aggregation Nodes" class="linkLabel_WmDU">Aggregation Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/advanced-nodes/time-windowed-join"><span title="Time-Windowed Joins" class="linkLabel_WmDU">Time-Windowed Joins</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/pipeline-definition"><span title="Pipeline Definition (IPipelineDefinition, PipelineBuilder)" class="linkLabel_WmDU">Pipeline Definition (IPipelineDefinition, PipelineBuilder)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/pipelinebuilder"><span title="PipelineBuilder" class="linkLabel_WmDU">PipelineBuilder</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/core-concepts/pipeline-execution"><span title="Pipeline Execution" class="categoryLinkLabel_W154">Pipeline Execution</span></a><button aria-label="Expand sidebar category &#x27;Pipeline Execution&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/pipeline-context"><span title="Pipeline Context (PipelineContext)" class="linkLabel_WmDU">Pipeline Context (PipelineContext)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/common-patterns"><span title="Common Patterns" class="linkLabel_WmDU">Common Patterns</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/streaming-vs-buffering"><span title="Streaming vs. Buffering" class="linkLabel_WmDU">Streaming vs. Buffering</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/best-practices"><span title="Best Practices" class="linkLabel_WmDU">Best Practices</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/pipeline-validation"><span title="Pipeline Validation Extensions - Usage Guide" class="linkLabel_WmDU">Pipeline Validation Extensions - Usage Guide</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/architecture/"><span title="Architecture" class="categoryLinkLabel_W154">Architecture</span></a><button aria-label="Collapse sidebar category &#x27;Architecture&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/core-concepts"><span title="Core Concepts" class="linkLabel_WmDU">Core Concepts</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/component-architecture"><span title="Component Architecture" class="linkLabel_WmDU">Component Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/execution-flow"><span title="Execution Flow" class="linkLabel_WmDU">Execution Flow</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/data-flow"><span title="Data Flow Details" class="linkLabel_WmDU">Data Flow Details</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/dependency-injection"><span title="Dependency Injection Integration" class="linkLabel_WmDU">Dependency Injection Integration</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/error-handling-architecture"><span title="Error Handling Architecture" class="linkLabel_WmDU">Error Handling Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/cancellation-model"><span title="Cancellation Model" class="linkLabel_WmDU">Cancellation Model</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/performance-characteristics"><span title="Performance Characteristics" class="linkLabel_WmDU">Performance Characteristics</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/extension-points"><span title="Extension Points" class="linkLabel_WmDU">Extension Points</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/design-principles"><span title="Design Principles" class="linkLabel_WmDU">Design Principles</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/optimization-principles"><span title="Optimization Principles - How NPipeline Achieves High Performance" class="linkLabel_WmDU">Optimization Principles - How NPipeline Achieves High Performance</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/extensions"><span title="Extensions" class="categoryLinkLabel_W154">Extensions</span></a><button aria-label="Expand sidebar category &#x27;Extensions&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/connectors"><span title="Connectors" class="categoryLinkLabel_W154">Connectors</span></a><button aria-label="Expand sidebar category &#x27;Connectors&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/advanced-topics"><span title="Advanced Topics" class="categoryLinkLabel_W154">Advanced Topics</span></a><button aria-label="Expand sidebar category &#x27;Advanced Topics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/analyzers/"><span title="Build-Time Analyzers" class="categoryLinkLabel_W154">Build-Time Analyzers</span></a><button aria-label="Expand sidebar category &#x27;Build-Time Analyzers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/samples-guide"><span title="Sample Applications" class="linkLabel_WmDU">Sample Applications</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/reference"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a><button aria-label="Expand sidebar category &#x27;Reference&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/core-concepts"><span>Core Concepts</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/core-concepts/advanced-nodes"><span>Advanced Nodes</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Aggregation Nodes</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Aggregation Nodes</h1></header>
<p>Aggregation nodes enable powerful summary calculations over streams of data. They are specialized for a specific requirement: handling data that arrives out of order while maintaining correctness.</p>
<p>For pipelines where events may arrive late or out of sequence—especially with parallel streams—aggregation provides the tools to group data by time windows while ensuring temporal correctness. When you configure aggregation, you define explicit rules about how much lateness the system will tolerate and when it should commit to results.</p>
<blockquote>
<p><strong>Related Pattern:</strong> <a class="" href="/docs/core-concepts/advanced-nodes/batching">Batching nodes</a> also group items together, but for different reasons—they focus on operational efficiency (reducing external system load). Aggregation is specialized for ensuring data correctness when events arrive out of order. Choose batching for throughput needs, aggregation for temporal accuracy needs.</p>
</blockquote>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="choosing-an-aggregation-base-class">Choosing an Aggregation Base Class<a href="#choosing-an-aggregation-base-class" class="hash-link" aria-label="Direct link to Choosing an Aggregation Base Class" title="Direct link to Choosing an Aggregation Base Class" translate="no">​</a></h2>
<p>NPipeline provides two aggregate base classes optimized for different scenarios:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-aggregatenodetin-tkey-tresult-simplified">1. <strong><code>AggregateNode&lt;TIn, TKey, TResult&gt;</code> (Simplified)</strong><a href="#1-aggregatenodetin-tkey-tresult-simplified" class="hash-link" aria-label="Direct link to 1-aggregatenodetin-tkey-tresult-simplified" title="Direct link to 1-aggregatenodetin-tkey-tresult-simplified" translate="no">​</a></h3>
<p>Use this when your <strong>accumulator and result types are the same</strong>. This is the most common case for simple aggregations like counting, summing, or collecting items into a collection.</p>
<p><strong>Type Parameters:</strong></p>
<ul>
<li class=""><code>TIn</code>: The type of input items to be aggregated.</li>
<li class=""><code>TKey</code>: The type of the key used for grouping items (e.g., a customer ID, a timestamp for time-based windows).</li>
<li class=""><code>TResult</code>: The type of the aggregation result (also used as the accumulator).</li>
</ul>
<p><strong>Methods to Override:</strong></p>
<ul>
<li class=""><code>GetKey(TIn item)</code>: Extract the grouping key from an input item.</li>
<li class=""><code>CreateAccumulator()</code>: Initialize a new accumulator.</li>
<li class=""><code>Accumulate(TResult accumulator, TIn item)</code>: Add an input item to the accumulator, returning the updated result.</li>
<li class="">(Automatically handles: <code>GetResult()</code> returns the accumulator as-is)</li>
</ul>
<p><strong>Best For:</strong></p>
<ul>
<li class="">Sums, counts, averages</li>
<li class="">Collecting items into lists or sets</li>
<li class="">Any scenario where intermediate state and final result are the same type</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-advancedaggregatenodetin-tkey-taccumulate-tresult-advanced">2. <strong><code>AdvancedAggregateNode&lt;TIn, TKey, TAccumulate, TResult&gt;</code> (Advanced)</strong><a href="#2-advancedaggregatenodetin-tkey-taccumulate-tresult-advanced" class="hash-link" aria-label="Direct link to 2-advancedaggregatenodetin-tkey-taccumulate-tresult-advanced" title="Direct link to 2-advancedaggregatenodetin-tkey-taccumulate-tresult-advanced" translate="no">​</a></h3>
<p>Use this when your <strong>accumulator and result types differ</strong>. This provides maximum flexibility for complex aggregation logic.</p>
<p><strong>Type Parameters:</strong></p>
<ul>
<li class=""><code>TIn</code>: The type of input items to be aggregated.</li>
<li class=""><code>TKey</code>: The type of the key used for grouping items.</li>
<li class=""><code>TAccumulate</code>: The type of the intermediate accumulation state.</li>
<li class=""><code>TResult</code>: The type of the final aggregated result.</li>
</ul>
<p><strong>Methods to Override:</strong></p>
<ul>
<li class=""><code>GetKey(TIn item)</code>: Extract the grouping key from an input item.</li>
<li class=""><code>CreateAccumulator()</code>: Initialize a new accumulator.</li>
<li class=""><code>Accumulate(TAccumulate accumulator, TIn item)</code>: Add an input item to the accumulator.</li>
<li class=""><code>GetResult(TAccumulate accumulator)</code>: Transform the final accumulator state into the desired result.</li>
</ul>
<p><strong>Best For:</strong></p>
<ul>
<li class="">Complex transformations where accumulator must have a different structure than result (e.g., accumulating as a list, returning as average)</li>
<li class="">Statistical computations (sum and count accumulated separately, then average computed on finalization)</li>
<li class="">Scenarios requiring conversion or projection in the final result</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="examples">Examples<a href="#examples" class="hash-link" aria-label="Direct link to Examples" title="Direct link to Examples" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="simple-aggregation-counting-items-by-category">Simple Aggregation: Counting Items by Category<a href="#simple-aggregation-counting-items-by-category" class="hash-link" aria-label="Direct link to Simple Aggregation: Counting Items by Category" title="Direct link to Simple Aggregation: Counting Items by Category" translate="no">​</a></h3>
<p>The simplified <code>AggregateNode</code> is perfect for this—accumulate counts directly:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Nodes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Pipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Product record for aggregation examples.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Represents a product with category, name, and price information.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed record Product(string Category, string Name, decimal Price);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Simple aggregation node that counts products by category.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Demonstrates simplified AggregateNode pattern where accumulator and result types are the same.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Uses tumbling window to group products into 1-minute time buckets.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed class CategoryCounterNode : AggregateNode&lt;Product, string, int&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CategoryCounterNode() : base(WindowAssigner.Tumbling(TimeSpan.FromMinutes(1)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Extracts category as grouping key for products.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Determines which bucket each product belongs to.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override string GetKey(Product item) =&gt; item.Category;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Creates initial accumulator for counting products.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Called once per unique key (category) when first encountered.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override int CreateAccumulator() =&gt; 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Increments count for each product in the category.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Called for each product that belongs to the same category.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override int Accumulate(int count, Product item) =&gt; count + 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Sensor reading record for aggregation examples.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Represents a sensor measurement with ID and value.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed record SensorReading(string SensorId, double Value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Advanced aggregation node that computes average sensor values.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Demonstrates AdvancedAggregateNode pattern where accumulator and result types differ.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Accumulates sum and count separately, then computes average on finalization.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed class AverageBySensorNode : AdvancedAggregateNode&lt;SensorReading, string, (double Sum, int Count), double&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public AverageBySensorNode() : base(WindowAssigner.Tumbling(TimeSpan.FromMinutes(5)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Extracts sensor ID as grouping key for readings.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Groups readings by which sensor generated them.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override string GetKey(SensorReading item) =&gt; item.SensorId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Creates initial accumulator with zero sum and count.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Called once per unique sensor when first encountered.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override (double Sum, int Count) CreateAccumulator() =&gt; (0, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Adds new reading to accumulator by updating sum and incrementing count.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Maintains both running sum and count for average calculation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override (double Sum, int Count) Accumulate((double Sum, int Count) acc, SensorReading item)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        =&gt; (acc.Sum + item.Value, acc.Count + 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Computes final average from accumulated sum and count.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Called when window closes to produce final result.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override double GetResult((double Sum, int Count) acc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        =&gt; acc.Count &gt; 0 ? acc.Sum / acc.Count : 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Pipeline definition demonstrating simple aggregation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Shows how to use simplified AggregateNode for counting operations.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static class SimpleAggregationProgram</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static async Task Main(string[] args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Create pipeline with in-memory source for demonstration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var pipeline = new PipelineBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddSource(new InMemorySourceNode&lt;Product&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new Product(&quot;Electronics&quot;, &quot;Laptop&quot;, 999m),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new Product(&quot;Books&quot;, &quot;C# Guide&quot;, 49.99m),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new Product(&quot;Electronics&quot;, &quot;Phone&quot;, 699m),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new Product(&quot;Books&quot;, &quot;Design Patterns&quot;, 54.99m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddAggregate&lt;CategoryCounterNode, Product, string, int&gt;(&quot;category_counter&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddSink(new ConsoleSink&lt;int&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Execute pipeline and wait for completion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await pipeline.RunAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Pipeline definition demonstrating advanced aggregation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Shows how to use AdvancedAggregateNode for complex calculations.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static class AdvancedAggregationProgram</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static async Task Main(string[] args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Create pipeline with sensor readings as input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var pipeline = new PipelineBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddSource(new InMemorySourceNode&lt;SensorReading&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new SensorReading(&quot;temp_1&quot;, 20.5),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new SensorReading(&quot;temp_1&quot;, 21.0),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new SensorReading(&quot;temp_2&quot;, 18.5),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new SensorReading(&quot;temp_1&quot;, 20.8)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddAggregate&lt;AverageBySensorNode, SensorReading, string, (double, int), double&gt;(&quot;sensor_average&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddSink(new ConsoleSink&lt;double&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Execute pipeline and wait for completion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await pipeline.RunAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Order event record for temporal aggregation examples.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Represents an order with embedded event time for temporal correctness.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed record OrderEvent(string OrderId, string EventType, decimal Amount, DateTime EventTime);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Aggregation state for order processing.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Maintains both count and total for computing average order value.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed record AggState(int Count, decimal Total);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Order summary result for aggregation output.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Contains aggregated information about orders in a time window.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed record OrderSummary(string OrderId, int Count);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Advanced aggregation node for processing orders with event-time semantics.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Demonstrates proper handling of out-of-order events with watermarks.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Uses event time (when order occurred) rather than arrival time.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderAggregationNode : AdvancedAggregateNode&lt;OrderEvent, string, AggState, OrderSummary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public OrderAggregationNode() : base(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        windowAssigner: new TumblingWindowAssigner(TimeSpan.FromMinutes(1)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timestampExtractor: order =&gt; order.EventTime,  // Use event time, not arrival time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxOutOfOrderness: TimeSpan.FromSeconds(30),   // Accept events up to 30 seconds late</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        watermarkInterval: TimeSpan.FromSeconds(5))   // Confirm correctness every 5 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Extracts order type as grouping key.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Groups orders by their event type (purchase, cancel, return, etc.).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override string GetKey(OrderEvent item) =&gt; item.EventType;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Creates initial accumulator with zero count and total.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Called once per unique order type when first encountered.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override AggState CreateAccumulator() =&gt; new AggState(0, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Adds order to accumulator by updating count and total.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Maintains running statistics for each order type.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override AggState Accumulate(AggState acc, OrderEvent item)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        =&gt; new AggState(acc.Count + 1, acc.Total + item.Amount);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Transforms accumulator state into final summary result.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Called when window closes to produce output.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override OrderSummary GetResult(AggState acc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        =&gt; new OrderSummary(acc.Count &gt; 0 ? (acc.Total / acc.Count).ToString(&quot;C&quot;) : &quot;0&quot;, acc.Count);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Order shipment event for multi-stream aggregation examples.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Represents shipment events from a separate system that may arrive out of order.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed record ShipmentEvent(string OrderId, DateTime EventTime);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Advanced aggregation for combining orders and shipments from multiple streams.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Demonstrates temporal correctness requirements in multi-stream ETL scenarios.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Handles events that arrive from different systems at different times.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderShipmentAggregationNode : AdvancedAggregateNode&lt;OrderEvent, string, AggState, (string OrderId, int Count)&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public OrderShipmentAggregationNode() : base(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        windowAssigner: new TumblingWindowAssigner(TimeSpan.FromMinutes(1)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timestampExtractor: evt =&gt; evt.EventTime,           // Use embedded event time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxOutOfOrderness: TimeSpan.FromSeconds(60),        // Tolerate up to 1 minute lateness</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        watermarkInterval: TimeSpan.FromSeconds(5))         // Promise correctness every 5 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Extracts order ID as grouping key.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Groups events by which order they relate to.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override string GetKey(OrderEvent item) =&gt; item.OrderId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Creates initial accumulator state.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Initializes counters for tracking order events.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override AggState CreateAccumulator() =&gt; new AggState(0, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Adds order event to accumulator.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Tracks both count and total amount for each order.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override AggState Accumulate(AggState acc, OrderEvent item)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        =&gt; new AggState(acc.Count + 1, acc.Total + item.Amount);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Creates final summary result from accumulator.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Transforms internal state to output format.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override (string OrderId, int Count) GetResult(AggState acc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        =&gt; (acc.Count &gt; 0 ? $&quot;avg_{acc.Total / acc.Count:C}&quot; : &quot;empty&quot;, acc.Count);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Result for Electronics: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Result for Books: 2</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="complex-aggregation-computing-averages">Complex Aggregation: Computing Averages<a href="#complex-aggregation-computing-averages" class="hash-link" aria-label="Direct link to Complex Aggregation: Computing Averages" title="Direct link to Complex Aggregation: Computing Averages" translate="no">​</a></h3>
<p>The advanced <code>AdvancedAggregateNode</code> is necessary here—accumulate sum and count, compute average on finalization:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Nodes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed record SensorReading(string SensorId, double Value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Complex aggregation: compute average while accumulating sum and count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed class AverageBySensorNode : AdvancedAggregateNode&lt;SensorReading, string, (double Sum, int Count), double&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public AverageBySensorNode() : base(WindowAssigner.Tumbling(TimeSpan.FromMinutes(5)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override string GetKey(SensorReading item) =&gt; item.SensorId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override (double Sum, int Count) CreateAccumulator() =&gt; (0, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override (double Sum, int Count) Accumulate((double Sum, int Count) acc, SensorReading item)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        =&gt; (acc.Sum + item.Value, acc.Count + 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override double GetResult((double Sum, int Count) acc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        =&gt; acc.Count &gt; 0 ? acc.Sum / acc.Count : 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static class Program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static async Task Main(string[] args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var pipeline = new PipelineBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddSource(new InMemorySourceNode&lt;SensorReading&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new SensorReading(&quot;temp_1&quot;, 20.5),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new SensorReading(&quot;temp_1&quot;, 21.0),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new SensorReading(&quot;temp_2&quot;, 18.5),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new SensorReading(&quot;temp_1&quot;, 20.8)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddAggregate&lt;AverageBySensorNode, SensorReading, string, (double, int), double&gt;(&quot;sensor_average&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddSink(new ConsoleSink&lt;double&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .Build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await pipeline.RunAsync();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Average for temp_1: 20.7666667</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Average for temp_2: 18.5</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="windowing-for-aggregation">Windowing for Aggregation<a href="#windowing-for-aggregation" class="hash-link" aria-label="Direct link to Windowing for Aggregation" title="Direct link to Windowing for Aggregation" translate="no">​</a></h2>
<p><code>AggregateNode</code> can be configured to operate over windows, allowing you to perform aggregations over specific time periods or a fixed number of items. This is typically configured during pipeline construction.</p>
<!-- -->
<p><em>Figure: Comparison of tumbling and sliding window patterns. Tumbling windows are fixed-size, non-overlapping intervals that emit results at the end of each window. Sliding windows have a fixed size but &quot;slide&quot; forward by a smaller interval, creating overlapping windows and more frequent emissions.</em></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="tumbling-windows-fixed-non-overlapping">Tumbling Windows (Fixed, Non-Overlapping)<a href="#tumbling-windows-fixed-non-overlapping" class="hash-link" aria-label="Direct link to Tumbling Windows (Fixed, Non-Overlapping)" title="Direct link to Tumbling Windows (Fixed, Non-Overlapping)" translate="no">​</a></h3>
<p>Tumbling windows produce a result for each fixed-size interval.</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Example (conceptual, implementation details may vary based on extensions)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Assuming a TimeWindowedAggregateNode for demonstration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// This would aggregate items every 5 seconds.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var pipeline = new PipelineBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .AddSource(new EventSource()) // Source that produces events with timestamps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .AddTransform(new TimeWindowedAggregateNode&lt;Event, int, int&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        windowSize: TimeSpan.FromSeconds(5),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        keySelector: e =&gt; e.EventType,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        accumulatorFactory: () =&gt; 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addInput: (acc, input) =&gt; acc + 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        getResult: (key, acc) =&gt; (key, acc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .AddSink(new ConsoleSink&lt;(int EventType, int Count)&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .Build();</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="sliding-windows-fixed-overlapping">Sliding Windows (Fixed, Overlapping)<a href="#sliding-windows-fixed-overlapping" class="hash-link" aria-label="Direct link to Sliding Windows (Fixed, Overlapping)" title="Direct link to Sliding Windows (Fixed, Overlapping)" translate="no">​</a></h3>
<p>Sliding windows also have a fixed size, but they &quot;slide&quot; by a smaller interval, leading to overlapping windows and more frequent results.</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Example (conceptual, implementation details may vary based on extensions)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// This would aggregate events in a 10-second window, sliding every 1 second.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var pipeline = new PipelineBuilder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .AddSource(new EventSource())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .AddTransform(new SlidingWindowAggregateNode&lt;Event, int, int&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        windowSize: TimeSpan.FromSeconds(10),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        slideInterval: TimeSpan.FromSeconds(1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        keySelector: e =&gt; e.EventType,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        accumulatorFactory: () =&gt; 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        addInput: (acc, input) =&gt; acc + 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        getResult: (key, acc) =&gt; (key, acc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .AddSink(new ConsoleSink&lt;(int EventType, int Count)&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .Build();</span><br></span></code></pre></div></div>
<p>The core library provides the windowing building blocks used by time-windowed aggregations. Future releases may include additional, higher-level extension packages that package common windowing operators; those would be additive to the primitive support already available in core.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="constructor-parameters-defining-your-correctness-guarantees">Constructor Parameters: Defining Your Correctness Guarantees<a href="#constructor-parameters-defining-your-correctness-guarantees" class="hash-link" aria-label="Direct link to Constructor Parameters: Defining Your Correctness Guarantees" title="Direct link to Constructor Parameters: Defining Your Correctness Guarantees" translate="no">​</a></h2>
<p>The <code>AggregateNode</code> constructor parameters define <strong>how your pipeline handles data that arrives out of order</strong>. These settings control when the system considers results final and which late-arriving events to accept.</p>
<ul>
<li class=""><strong>windowAssigner</strong> (<code>WindowAssigner</code>): The window assigner strategy defines how time windows are bounded (required). This determines the temporal scope of each aggregation result.</li>
<li class=""><strong>timestampExtractor</strong> (<code>TimestampExtractor&lt;TIn&gt;?</code>, optional): A function to extract timestamps from input items. If not provided, system time of arrival will be used. <strong>Why this matters:</strong> This separates event time (when the event actually occurred in the external system) from arrival time (when the event reached your pipeline). For data correctness, this distinction is essential when processing multiple streams.</li>
<li class=""><strong>maxOutOfOrderness</strong> (<code>TimeSpan?</code>, optional, defaults to 5 minutes): The maximum allowed lateness for out-of-order events. This setting tells the system: &quot;Accept events arriving up to this long after I expect them, but discard anything later.&quot; If you have parallel streams arriving slightly out of sync, this parameter defines how much temporal variation the system will tolerate. The default of 5 minutes represents a practical choice for most ETL scenarios.</li>
<li class=""><strong>watermarkInterval</strong> (<code>TimeSpan?</code>, optional, defaults to 30 seconds): How frequently the system emits a watermark to advance its view of event time. Think of watermarks as the system&#x27;s way of saying: &quot;I am confident about results up to this point. Anything arriving later is outside my guarantee.&quot; Setting it to 30 seconds means the system commits to tracking correctness with 30-second granularity.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-understanding-the-contract">Example: Understanding the Contract<a href="#example-understanding-the-contract" class="hash-link" aria-label="Direct link to Example: Understanding the Contract" title="Direct link to Example: Understanding the Contract" translate="no">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Example constructor usage showing practical configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// This example uses AdvancedAggregateNode because it transforms the accumulator to a different result type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderAggregationNode : AdvancedAggregateNode&lt;Order, string, (int Count, decimal Total), OrderSummary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public OrderAggregationNode() : base(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        windowAssigner: new TumblingWindowAssigner(TimeSpan.FromMinutes(1)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timestampExtractor: order =&gt; order.EventTime,  // Use event time, not arrival time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxOutOfOrderness: TimeSpan.FromSeconds(30),   // Accept events up to 30 seconds late</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        watermarkInterval: TimeSpan.FromSeconds(10))   // Confirm correctness every 10 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // With these settings, you&#x27;re saying:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // - Group events into 1-minute windows based on when they occurred</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // - Include events that arrive up to 30 seconds after their event time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // - Every 10 seconds, finalize and emit results for events up to that point</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>This contract is essential in complex ETL scenarios. Without explicit event-time semantics and watermarks, you lose the ability to reason about temporal correctness when data arrives out of order.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="event-time-semantics-and-watermarks-the-architectural-foundation">Event-Time Semantics and Watermarks: The Architectural Foundation<a href="#event-time-semantics-and-watermarks-the-architectural-foundation" class="hash-link" aria-label="Direct link to Event-Time Semantics and Watermarks: The Architectural Foundation" title="Direct link to Event-Time Semantics and Watermarks: The Architectural Foundation" translate="no">​</a></h2>
<p>Aggregation in NPipeline is fundamentally about managing <strong>event-time semantics</strong> in the face of out-of-order and late-arriving data. This is where aggregation moves beyond a simple data transformation to become an architectural decision about stream correctness.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="event-time-vs-arrival-time">Event Time vs. Arrival Time<a href="#event-time-vs-arrival-time" class="hash-link" aria-label="Direct link to Event Time vs. Arrival Time" title="Direct link to Event Time vs. Arrival Time" translate="no">​</a></h3>
<ul>
<li class=""><strong>Event Time:</strong> The timestamp embedded in the data itself, representing when the event actually occurred in the external system.</li>
<li class=""><strong>Arrival Time:</strong> The time when the event physically reached your pipeline.</li>
</ul>
<p>In ETL pipelines with multiple parallel streams, these times diverge. Events from stream A might arrive before events from stream B, even if stream B&#x27;s events occurred earlier. Without explicit event-time tracking, you lose the ability to reason about the true temporal ordering of your data.</p>
<p>When you configure a <code>timestampExtractor</code>, you are choosing event-time semantics. This choice has consequences: the pipeline now must manage state across windows defined by event time, not by arrival order. This is both powerful and costly.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="watermarks-promises-about-correctness">Watermarks: Promises About Correctness<a href="#watermarks-promises-about-correctness" class="hash-link" aria-label="Direct link to Watermarks: Promises About Correctness" title="Direct link to Watermarks: Promises About Correctness" translate="no">​</a></h3>
<p>A <strong>watermark</strong> is a temporal marker that represents a commitment from the pipeline: &quot;All events with timestamps up to this point have been processed. Later-arriving events with earlier timestamps are outside my guarantee.&quot;</p>
<p>When you set <code>watermarkInterval: TimeSpan.FromSeconds(10)</code>, you are saying:</p>
<ul>
<li class="">Every 10 seconds, emit a watermark advancing the event-time frontier.</li>
<li class="">Events arriving after this watermark with timestamps before the watermark are &quot;late.&quot;</li>
<li class="">The system makes no guarantee about the correctness of aggregations for events arriving later than <code>maxOutOfOrderness</code> beyond this watermark.</li>
</ul>
<p>This is not performance tuning. This is defining the contract. If you set a 10-second watermark and 30-second max-out-of-orderness, you are saying: &quot;I will tolerate data arriving up to 30 seconds late, but I will only promise temporal correctness in 10-second increments.&quot;</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="practical-example-multi-stream-etl">Practical Example: Multi-Stream ETL<a href="#practical-example-multi-stream-etl" class="hash-link" aria-label="Direct link to Practical Example: Multi-Stream ETL" title="Direct link to Practical Example: Multi-Stream ETL" translate="no">​</a></h3>
<p>Imagine you are aggregating orders and shipments from two different external systems:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// This example uses AdvancedAggregateNode because it maintains complex accumulation state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OrderShipmentAggregationNode : AdvancedAggregateNode&lt;OrderEvent, string, AggState, (string OrderId, int Count)&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public OrderShipmentAggregationNode() : base(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        windowAssigner: new TumblingWindowAssigner(TimeSpan.FromMinutes(1)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timestampExtractor: evt =&gt; evt.EventTime,           // Use embedded event time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxOutOfOrderness: TimeSpan.FromSeconds(60),        // Tolerate up to 1 minute of lateness</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        watermarkInterval: TimeSpan.FromSeconds(5))         // Promise correctness every 5 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Here, you are deciding:</p>
<ul>
<li class="">Orders and shipments are grouped into 1-minute windows based on when they occurred, not when they arrived.</li>
<li class="">If a shipment arrives 55 seconds late, it will still be included in the correct window (because 55 seconds &lt; 60 seconds max lateness).</li>
<li class="">If a shipment arrives 70 seconds late, it is discarded as outside the integrity guarantee.</li>
<li class="">Every 5 seconds, the system publishes a watermark saying &quot;I guarantee correctness for all events with event-time up to this point.&quot;</li>
</ul>
<p>This architecture is essential for multi-stream ETL where data latency and ordering are real concerns, not theoretical ones.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps" translate="no">​</a></h2>
<ul>
<li class=""><strong><a class="" href="/docs/core-concepts/advanced-nodes/batching">Batching Nodes</a></strong>: Discover how to group items into batches for processing.</li>
<li class=""><strong><a class="" href="/docs/core-concepts/advanced-nodes/join">Join Nodes</a></strong>: Learn about merging data from multiple streams.</li>
</ul></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/core-concepts/advanced-nodes/type-conversion"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Type Conversion Nodes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/core-concepts/advanced-nodes/time-windowed-join"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Time-Windowed Joins</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#choosing-an-aggregation-base-class" class="table-of-contents__link toc-highlight">Choosing an Aggregation Base Class</a><ul><li><a href="#1-aggregatenodetin-tkey-tresult-simplified" class="table-of-contents__link toc-highlight">1. <strong><code>AggregateNode&lt;TIn, TKey, TResult&gt;</code> (Simplified)</strong></a></li><li><a href="#2-advancedaggregatenodetin-tkey-taccumulate-tresult-advanced" class="table-of-contents__link toc-highlight">2. <strong><code>AdvancedAggregateNode&lt;TIn, TKey, TAccumulate, TResult&gt;</code> (Advanced)</strong></a></li></ul></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a><ul><li><a href="#simple-aggregation-counting-items-by-category" class="table-of-contents__link toc-highlight">Simple Aggregation: Counting Items by Category</a></li><li><a href="#complex-aggregation-computing-averages" class="table-of-contents__link toc-highlight">Complex Aggregation: Computing Averages</a></li></ul></li><li><a href="#windowing-for-aggregation" class="table-of-contents__link toc-highlight">Windowing for Aggregation</a><ul><li><a href="#tumbling-windows-fixed-non-overlapping" class="table-of-contents__link toc-highlight">Tumbling Windows (Fixed, Non-Overlapping)</a></li><li><a href="#sliding-windows-fixed-overlapping" class="table-of-contents__link toc-highlight">Sliding Windows (Fixed, Overlapping)</a></li></ul></li><li><a href="#constructor-parameters-defining-your-correctness-guarantees" class="table-of-contents__link toc-highlight">Constructor Parameters: Defining Your Correctness Guarantees</a><ul><li><a href="#example-understanding-the-contract" class="table-of-contents__link toc-highlight">Example: Understanding the Contract</a></li></ul></li><li><a href="#event-time-semantics-and-watermarks-the-architectural-foundation" class="table-of-contents__link toc-highlight">Event-Time Semantics and Watermarks: The Architectural Foundation</a><ul><li><a href="#event-time-vs-arrival-time" class="table-of-contents__link toc-highlight">Event Time vs. Arrival Time</a></li><li><a href="#watermarks-promises-about-correctness" class="table-of-contents__link toc-highlight">Watermarks: Promises About Correctness</a></li><li><a href="#practical-example-multi-stream-etl" class="table-of-contents__link toc-highlight">Practical Example: Multi-Stream ETL</a></li></ul></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/why-npipeline">Why NPipeline?</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/installation">Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/quick-start">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/core-concepts">Core Concepts</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/npipeline/npipeline" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">&nbsp;</div></div></div></footer></div>
</body>
</html>