<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-core-concepts/resilience/error-handling-guide" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Error Handling in NPipeline | NPipeline</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="robots" content="noindex, nofollow"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://npipeline.dev/docs/core-concepts/resilience/error-handling-guide"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Error Handling in NPipeline | NPipeline"><meta data-rh="true" name="description" content="Comprehensive guide to error handling at both node and pipeline levels in NPipeline"><meta data-rh="true" property="og:description" content="Comprehensive guide to error handling at both node and pipeline levels in NPipeline"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://npipeline.dev/docs/core-concepts/resilience/error-handling-guide"><link data-rh="true" rel="alternate" href="https://npipeline.dev/docs/core-concepts/resilience/error-handling-guide" hreflang="en"><link data-rh="true" rel="alternate" href="https://npipeline.dev/docs/core-concepts/resilience/error-handling-guide" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Core Concepts","item":"https://npipeline.dev/docs/core-concepts"},{"@type":"ListItem","position":2,"name":"Resilience","item":"https://npipeline.dev/docs/core-concepts/resilience/"},{"@type":"ListItem","position":3,"name":"Error Handling in NPipeline","item":"https://npipeline.dev/docs/core-concepts/resilience/error-handling-guide"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="NPipeline RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="NPipeline Atom Feed"><link rel="stylesheet" href="/assets/css/styles.03259981.css">
<script src="/assets/js/runtime~main.c2104d5d.js" defer="defer"></script>
<script src="/assets/js/main.de11df6d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="NPipeline logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="NPipeline logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">NPipeline</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/npipeline/npipeline" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/"><span title="Welcome to NPipeline" class="linkLabel_WmDU">Welcome to NPipeline</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/introduction"><span title="Introduction" class="categoryLinkLabel_W154">Introduction</span></a><button aria-label="Expand sidebar category &#x27;Introduction&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learning-paths"><span title="Learning Paths" class="linkLabel_WmDU">Learning Paths</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/getting-started"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/docs/core-concepts"><span title="Core Concepts" class="categoryLinkLabel_W154">Core Concepts</span></a><button aria-label="Collapse sidebar category &#x27;Core Concepts&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/grouping-strategies"><span title="Grouping Strategies - Batching vs Aggregation" class="linkLabel_WmDU">Grouping Strategies - Batching vs Aggregation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/ipipeline"><span title="Pipeline" class="linkLabel_WmDU">Pipeline</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/data-pipes"><span title="Data Pipes (IDataPipe)" class="linkLabel_WmDU">Data Pipes (IDataPipe)</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/core-concepts/nodes/"><span title="Nodes" class="categoryLinkLabel_W154">Nodes</span></a><button aria-label="Collapse sidebar category &#x27;Nodes&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/nodes/source-nodes"><span title="Source Nodes" class="linkLabel_WmDU">Source Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/nodes/batching"><span title="Batching Nodes" class="linkLabel_WmDU">Batching Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/nodes/transform-nodes"><span title="Transform Nodes" class="linkLabel_WmDU">Transform Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/nodes/join"><span title="Join Nodes" class="linkLabel_WmDU">Join Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/nodes/sink-nodes"><span title="Sink Nodes" class="linkLabel_WmDU">Sink Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/nodes/lookup"><span title="Lookup Nodes" class="linkLabel_WmDU">Lookup Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/nodes/branch"><span title="Branch Nodes" class="linkLabel_WmDU">Branch Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/nodes/tap"><span title="Tap Nodes" class="linkLabel_WmDU">Tap Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/nodes/type-conversion"><span title="Type Conversion Nodes" class="linkLabel_WmDU">Type Conversion Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/nodes/aggregation"><span title="Aggregation Nodes" class="linkLabel_WmDU">Aggregation Nodes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/nodes/time-windowed-join"><span title="Time-Windowed Joins" class="linkLabel_WmDU">Time-Windowed Joins</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/core-concepts/resilience/"><span title="Resilience" class="categoryLinkLabel_W154">Resilience</span></a><button aria-label="Collapse sidebar category &#x27;Resilience&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/core-concepts/resilience/error-handling-guide"><span title="Error Handling in NPipeline" class="linkLabel_WmDU">Error Handling in NPipeline</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/resilience/execution-with-resilience"><span title="Execution with Resilience" class="linkLabel_WmDU">Execution with Resilience</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/resilience/node-restart-quickstart"><span title="Node Restart - Quick Start Checklist" class="linkLabel_WmDU">Node Restart - Quick Start Checklist</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/resilience/circuit-breaker-advanced-configuration"><span title="Circuit Breaker Advanced Configuration" class="linkLabel_WmDU">Circuit Breaker Advanced Configuration</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/resilience/materialization-and-buffering"><span title="Materialization and Buffering" class="linkLabel_WmDU">Materialization and Buffering</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/resilience/dependency-chains"><span title="Dependency Chains" class="linkLabel_WmDU">Dependency Chains</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/resilience/configuration-guide"><span title="Configuration Guide" class="linkLabel_WmDU">Configuration Guide</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/resilience/troubleshooting"><span title="Troubleshooting" class="linkLabel_WmDU">Troubleshooting</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/resilience/retry-configuration"><span title="Retry Configuration" class="linkLabel_WmDU">Retry Configuration</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/resilience/circuit-breaker-configuration"><span title="Circuit Breaker Configuration" class="linkLabel_WmDU">Circuit Breaker Configuration</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/resilience/retry-delay-quickstart"><span title="Retry Delay Quickstart" class="linkLabel_WmDU">Retry Delay Quickstart</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/resilience/dead-letter-queues"><span title="Dead-Letter Queues" class="linkLabel_WmDU">Dead-Letter Queues</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/pipeline-definition"><span title="Pipeline Definition (IPipelineDefinition, PipelineBuilder)" class="linkLabel_WmDU">Pipeline Definition (IPipelineDefinition, PipelineBuilder)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/pipelinebuilder"><span title="PipelineBuilder" class="linkLabel_WmDU">PipelineBuilder</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/core-concepts/pipeline-execution"><span title="Pipeline Execution" class="categoryLinkLabel_W154">Pipeline Execution</span></a><button aria-label="Expand sidebar category &#x27;Pipeline Execution&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/pipeline-context"><span title="Pipeline Context (PipelineContext)" class="linkLabel_WmDU">Pipeline Context (PipelineContext)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/common-patterns"><span title="Common Patterns" class="linkLabel_WmDU">Common Patterns</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/streaming-vs-buffering"><span title="Streaming vs. Buffering" class="linkLabel_WmDU">Streaming vs. Buffering</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/best-practices"><span title="Best Practices" class="linkLabel_WmDU">Best Practices</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts/pipeline-validation"><span title="Pipeline Validation Extensions - Usage Guide" class="linkLabel_WmDU">Pipeline Validation Extensions - Usage Guide</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/architecture/"><span title="Architecture" class="categoryLinkLabel_W154">Architecture</span></a><button aria-label="Collapse sidebar category &#x27;Architecture&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/core-concepts"><span title="Core Concepts" class="linkLabel_WmDU">Core Concepts</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/component-architecture"><span title="Component Architecture" class="linkLabel_WmDU">Component Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/execution-flow"><span title="Execution Flow" class="linkLabel_WmDU">Execution Flow</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/data-flow"><span title="Data Flow Details" class="linkLabel_WmDU">Data Flow Details</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/dependency-injection"><span title="Dependency Injection Integration" class="linkLabel_WmDU">Dependency Injection Integration</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/error-handling-architecture"><span title="Error Handling Architecture" class="linkLabel_WmDU">Error Handling Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/cancellation-model"><span title="Cancellation Model" class="linkLabel_WmDU">Cancellation Model</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/performance-characteristics"><span title="Performance Characteristics" class="linkLabel_WmDU">Performance Characteristics</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/retry-delay-architecture"><span title="Retry Delay Strategies Architecture" class="linkLabel_WmDU">Retry Delay Strategies Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/extension-points"><span title="Extension Points" class="linkLabel_WmDU">Extension Points</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/design-principles"><span title="Design Principles" class="linkLabel_WmDU">Design Principles</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/optimization-principles"><span title="Optimization Principles - How NPipeline Achieves High Performance" class="linkLabel_WmDU">Optimization Principles - How NPipeline Achieves High Performance</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/extensions"><span title="Extensions" class="categoryLinkLabel_W154">Extensions</span></a><button aria-label="Expand sidebar category &#x27;Extensions&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/connectors"><span title="Connectors" class="categoryLinkLabel_W154">Connectors</span></a><button aria-label="Expand sidebar category &#x27;Connectors&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/advanced-topics"><span title="Advanced Topics" class="categoryLinkLabel_W154">Advanced Topics</span></a><button aria-label="Expand sidebar category &#x27;Advanced Topics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/analyzers/"><span title="Build-Time Analyzers" class="categoryLinkLabel_W154">Build-Time Analyzers</span></a><button aria-label="Expand sidebar category &#x27;Build-Time Analyzers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/samples-guide"><span title="Sample Applications" class="linkLabel_WmDU">Sample Applications</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/reference"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a><button aria-label="Expand sidebar category &#x27;Reference&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/core-concepts"><span>Core Concepts</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/core-concepts/resilience/"><span>Resilience</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Error Handling in NPipeline</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Error Handling in NPipeline</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" translate="no">​</a></h2>
<p>Before understanding error handling, you should be familiar with:</p>
<ul>
<li class=""><a class="" href="/docs/core-concepts">Core Concepts Overview</a> - Basic NPipeline concepts and terminology</li>
<li class=""><a class="" href="/docs/core-concepts/nodes/">Nodes Overview</a> - Understanding the node types where errors occur</li>
<li class=""><a class="" href="/docs/core-concepts/pipelinebuilder">PipelineBuilder</a> - How to configure error handling in pipeline construction</li>
<li class=""><a class="" href="/docs/core-concepts/pipeline-execution/execution-strategies">Execution Strategies</a> - How error handling integrates with execution</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>Robust error handling is critical for building reliable data pipelines. NPipeline provides several mechanisms to manage errors that occur during data processing, allowing you to gracefully recover, retry operations, or isolate problematic data.</p>
<p>By default, if an unhandled exception occurs within a node during pipeline execution, the exception will propagate up the call stack, potentially halting the entire pipeline. While this behavior is suitable for critical errors that should stop processing immediately, it&#x27;s often desirable to handle errors more selectively without bringing down the entire system.</p>
<p>Errors in NPipeline can generally be categorized by their source and impact:</p>
<ul>
<li class=""><strong>Node-Specific Errors</strong>: Exceptions originating from logic within a specific <code>ISourceNode</code>, <code>ITransformNode</code>, or <code>ISinkNode</code>.</li>
<li class=""><strong>Data-Related Errors</strong>: Issues caused by the data itself (e.g., invalid format, missing values) that a node attempts to process.</li>
<li class=""><strong>Infrastructure Errors</strong>: Problems related to external dependencies like databases, APIs, or network connectivity.</li>
<li class=""><strong>Cancellation</strong>: While not strictly an &quot;error,&quot; a <a href="https://learn.microsoft.com/en-us/dotnet/api/system.threading.cancellationtoken" target="_blank" rel="noopener noreferrer" class=""><code>CancellationToken</code></a> can signal an intentional halt to processing, which nodes should handle gracefully.</li>
</ul>
<p>NPipeline distinguishes between two levels of error handling:</p>
<ol>
<li class=""><strong>Node-level Error Handling</strong>: Deals with errors that occur while processing an individual item within a specific node. You define what happens to that item (e.g., skip, retry, redirect to dead-letter).</li>
<li class=""><strong>Pipeline-level Error Handling</strong>: Deals with more severe errors that might affect an entire node&#x27;s stream or the pipeline&#x27;s execution flow (e.g., restarting a failing node, failing the entire pipeline).</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="choosing-your-error-handling-approach">Choosing Your Error Handling Approach<a href="#choosing-your-error-handling-approach" class="hash-link" aria-label="Direct link to Choosing Your Error Handling Approach" title="Direct link to Choosing Your Error Handling Approach" translate="no">​</a></h2>
<!-- -->
<p>This decision tree helps you determine the appropriate error handling approach based on your specific needs:</p>
<ul>
<li class="">
<p><strong>Node-level Error Handling</strong> for individual item failures:</p>
<ul>
<li class=""><strong>Retry</strong> transient errors (network issues, temporary resource constraints)</li>
<li class=""><strong>Skip</strong> non-critical errors or malformed data</li>
<li class=""><strong>Dead Letter</strong> problematic items for later analysis</li>
<li class=""><strong>Fail</strong> when errors indicate critical system issues</li>
</ul>
</li>
<li class="">
<p><strong>Pipeline-level Error Handling</strong> for entire stream/node failures:</p>
<ul>
<li class=""><strong>Restart Node</strong> when failures are transient and recoverable</li>
<li class=""><strong>Continue Without Node</strong> when the node is non-critical to overall operation</li>
<li class=""><strong>Fail Pipeline</strong> when errors indicate system-wide problems</li>
</ul>
</li>
<li class="">
<p><strong>Combined Approach</strong> when you need to handle both individual item and stream-level errors</p>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="error-handling-levels">Error Handling Levels<a href="#error-handling-levels" class="hash-link" aria-label="Direct link to Error Handling Levels" title="Direct link to Error Handling Levels" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="node-level-error-handling">Node-Level Error Handling<a href="#node-level-error-handling" class="hash-link" aria-label="Direct link to Node-Level Error Handling" title="Direct link to Node-Level Error Handling" translate="no">​</a></h3>
<p>Node-level error handling in NPipeline allows you to manage errors that occur while processing individual items within a specific node. This granular approach enables you to define what happens to each problematic item without affecting the entire pipeline.</p>
<p>When an error occurs during the processing of an individual item in a node, NPipeline&#x27;s error handling mechanism invokes the appropriate <code>INodeErrorHandler</code> to determine how to proceed. This allows you to implement strategies like retrying the item, skipping it, or redirecting it to a dead-letter queue.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="inodeerrorhandler-interface">INodeErrorHandler Interface<a href="#inodeerrorhandler-interface" class="hash-link" aria-label="Direct link to INodeErrorHandler Interface" title="Direct link to INodeErrorHandler Interface" translate="no">​</a></h4>
<p>To handle errors within a specific node, you implement <a class="" href="/src/NPipeline/Abstractions/ErrorHandling/INodeErrorHandler.cs"><code>INodeErrorHandler&lt;in TNode, in TData&gt;</code></a> interface.</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface INodeErrorHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">///     Defines the contract for handling errors that occur within a specific node.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;typeparam name=&quot;TNode&quot;&gt;The type of node where the error occurred.&lt;/typeparam&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;typeparam name=&quot;TData&quot;&gt;The type of the data item that failed.&lt;/typeparam&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface INodeErrorHandler&lt;in TNode, in TData&gt; : INodeErrorHandler where TNode : INode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ///     Handles an error that occurred during node execution.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;node&quot;&gt;The instance of node that failed.&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;failedItem&quot;&gt;The data item that caused the error.&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;error&quot;&gt;The exception that was thrown.&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;context&quot;&gt;The current pipeline context.&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;param name=&quot;cancellationToken&quot;&gt;A token to observe for cancellation requests.&lt;/param&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;returns&gt;A &lt;see cref=&quot;NodeErrorDecision&quot; /&gt; indicating how to proceed.&lt;/returns&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Task&lt;NodeErrorDecision&gt; HandleAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TNode node,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TData failedItem,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Exception error,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken cancellationToken);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<ul>
<li class=""><strong><code>INodeErrorHandler</code></strong>: Marker interface for dependency injection registration of node error handlers.</li>
<li class=""><strong><code>INodeErrorHandler&lt;in TNode, in TData&gt;</code></strong>: Generic interface that inherits from the marker interface and defines the actual error handling logic.</li>
<li class=""><strong><code>TNode</code></strong>: The type of node where the error occurred.</li>
<li class=""><strong><code>TData</code></strong>: The type of the data item that caused the error.</li>
<li class=""><strong><code>HandleAsync</code></strong>: This method is called when an error occurs. It receives the failing node, item, exception, and pipeline context. It must return a <code>NodeErrorDecision</code>.</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="nodeerrordecision">NodeErrorDecision<a href="#nodeerrordecision" class="hash-link" aria-label="Direct link to NodeErrorDecision" title="Direct link to NodeErrorDecision" translate="no">​</a></h4>
<p>This enum dictates how the pipeline should proceed after a node-level error:</p>
<ul>
<li class=""><strong><code>Skip</code></strong>: The failed item is discarded, and the pipeline continues processing subsequent items.</li>
<li class=""><strong><code>Retry</code></strong>: The pipeline attempts to re-process the failed item. The number of retries is configured via <code>PipelineRetryOptions</code>.</li>
<li class=""><strong><code>DeadLetter</code></strong>: The failed item is sent to a configured dead-letter sink, and the pipeline continues.</li>
<li class=""><strong><code>Fail</code></strong>: The pipeline immediately terminates with an exception.</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="implementing-a-custom-node-error-handler">Implementing a Custom Node Error Handler<a href="#implementing-a-custom-node-error-handler" class="hash-link" aria-label="Direct link to Implementing a Custom Node Error Handler" title="Direct link to Implementing a Custom Node Error Handler" translate="no">​</a></h4>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.ErrorHandling;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Nodes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Pipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Custom node error handler for transform nodes processing string data.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Demonstrates error classification and appropriate response strategies.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed class MyNodeErrorHandler : INodeErrorHandler&lt;ITransformNode&lt;string, string&gt;, string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly ILogger _logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public MyNodeErrorHandler(ILogger logger)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger = logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Handles errors that occur during string transformation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Implements different strategies based on error type for optimal recovery.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Task&lt;NodeErrorDecision&gt; HandleAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ITransformNode&lt;string, string&gt; node,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string failedItem,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Exception error,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken cancellationToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Log error with full context for troubleshooting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger.LogError(error, &quot;Error in node &#x27;{NodeName}&#x27; processing &#x27;{FailedItem}&#x27;: {ErrorMessage}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            node.Name, failedItem, error.Message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Choose error handling strategy based on exception type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return error switch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Data format errors are permanent - send to dead letter queue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FormatException =&gt; Task.FromResult(NodeErrorDecision.DeadLetter),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Items marked for retry get another chance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ when failedItem.Contains(&quot;retry&quot;) =&gt; Task.FromResult(NodeErrorDecision.Retry),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // All other errors are skipped to continue processing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; Task.FromResult(NodeErrorDecision.Skip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="registering-a-node-error-handler">Registering a Node Error Handler<a href="#registering-a-node-error-handler" class="hash-link" aria-label="Direct link to Registering a Node Error Handler" title="Direct link to Registering a Node Error Handler" translate="no">​</a></h4>
<p>You register a node error handler for a specific node using the <code>WithErrorHandler</code> method on <code>PipelineBuilder</code>:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.ErrorHandling;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Pipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed class ErrorHandlingPipelineDefinition : IPipelineDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Define(PipelineBuilder builder, PipelineContext context)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var sourceHandle = builder.AddSource&lt;DataSource, string&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var transformHandle = builder.AddTransform&lt;DataTransform, string, string&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var sinkHandle = builder.AddSink&lt;DataSink, string&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.Connect(sourceHandle, transformHandle);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.Connect(transformHandle, sinkHandle);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Configure retry options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.WithRetryOptions(new PipelineRetryOptions(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxItemRetries: 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxNodeRestartAttempts: 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxSequentialNodeAttempts: 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>You also need to register your custom error handler with your DI container:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">services.AddSingleton&lt;INodeErrorHandler&lt;ITransformNode&lt;string, string&gt;, string&gt;, MyNodeErrorHandler&gt;();</span><br></span></code></pre></div></div>
<p>The marker interface <code>INodeErrorHandler</code> (non-generic version) is used for dependency injection registration purposes, allowing the DI container to discover all node error handler implementations.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-node-error-handling-scenarios">Common Node Error Handling Scenarios<a href="#common-node-error-handling-scenarios" class="hash-link" aria-label="Direct link to Common Node Error Handling Scenarios" title="Direct link to Common Node Error Handling Scenarios" translate="no">​</a></h4>
<p><strong>Scenario 1: Handling Transient Network Errors</strong></p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class NetworkErrorHandler : INodeErrorHandler&lt;IApiTransformNode, string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly ILogger _logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int _retryCount = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public NetworkErrorHandler(ILogger logger)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger = logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Handles network errors with exponential backoff retry strategy.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Transient errors are retried, persistent failures are redirected.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Task&lt;NodeErrorDecision&gt; HandleAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IApiTransformNode node,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string failedItem,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Exception error,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken cancellationToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Handle network-related errors specifically</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (error is HttpRequestException httpEx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _retryCount++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _logger.LogWarning(&quot;Network error (attempt {RetryCount}): {ErrorMessage}&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                _retryCount, httpEx.Message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Retry up to 3 times for transient network errors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (_retryCount &lt;= 3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return Task.FromResult(NodeErrorDecision.Retry);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // After max retries, reset counter and redirect to dead letter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                _retryCount = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return Task.FromResult(NodeErrorDecision.DeadLetter);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Non-network errors are skipped to continue processing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Task.FromResult(NodeErrorDecision.Skip);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Scenario 2: Data Validation Errors</strong></p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ValidationErrorHandler : INodeErrorHandler&lt;IValidatorNode, string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly ILogger _logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ValidationErrorHandler(ILogger logger)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger = logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Handles validation errors by redirecting to dead letter queue.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Data quality issues are logged separately from system errors.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Task&lt;NodeErrorDecision&gt; HandleAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IValidatorNode node,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string failedItem,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Exception error,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken cancellationToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Handle validation errors specifically</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (error is ValidationException validationEx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _logger.LogWarning(&quot;Validation failed for item: {Item}. Error: {Error}&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                failedItem, validationEx.Message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Validation failures indicate data quality issues - redirect for manual review</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Task.FromResult(NodeErrorDecision.DeadLetter);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Other types of errors are skipped to continue processing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Task.FromResult(NodeErrorDecision.Skip);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pipeline-level-error-handling">Pipeline-Level Error Handling<a href="#pipeline-level-error-handling" class="hash-link" aria-label="Direct link to Pipeline-Level Error Handling" title="Direct link to Pipeline-Level Error Handling" translate="no">​</a></h3>
<p>Pipeline-level error handling in NPipeline is designed to manage errors that affect an entire node&#x27;s stream rather than individual items. These are typically more severe errors that might impact the entire pipeline execution flow, such as infrastructure failures or external service outages.</p>
<p>When an error occurs that affects an entire node&#x27;s stream (e.g., an external service going down), NPipeline&#x27;s <code>ResilientExecutionStrategy</code> consults the configured <code>IPipelineErrorHandler</code> to determine how to react to such failures. This allows you to implement strategies like restarting a failing node, continuing without it, or failing the entire pipeline.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="ipipelineerrorhandler-interface">IPipelineErrorHandler Interface<a href="#ipipelineerrorhandler-interface" class="hash-link" aria-label="Direct link to IPipelineErrorHandler Interface" title="Direct link to IPipelineErrorHandler Interface" translate="no">​</a></h4>
<p>For errors that affect an entire node&#x27;s stream, you implement <a class="" href="/src/NPipeline/Abstractions/ErrorHandling/IPipelineErrorHandler.cs"><code>IPipelineErrorHandler</code></a> interface.</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface IPipelineErrorHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Task&lt;PipelineErrorDecision&gt; HandleNodeFailureAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string nodeId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Exception error,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken cancellationToken);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="pipelineerrordecision">PipelineErrorDecision<a href="#pipelineerrordecision" class="hash-link" aria-label="Direct link to PipelineErrorDecision" title="Direct link to PipelineErrorDecision" translate="no">​</a></h4>
<p>This enum defines the decision when a node stream fails:</p>
<ul>
<li class=""><strong><code>RestartNode</code></strong>: The node&#x27;s entire input stream will be re-processed from the beginning (requires the input stream to be replayable, e.g., if materialized by <code>ResilientExecutionStrategy</code>).</li>
<li class=""><strong><code>ContinueWithoutNode</code></strong>: The failing node is effectively removed from the pipeline, and its output stream will be empty. The pipeline continues without it.</li>
<li class=""><strong><code>FailPipeline</code></strong>: The entire pipeline execution terminates.</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="implementing-a-custom-pipeline-error-handler">Implementing a Custom Pipeline Error Handler<a href="#implementing-a-custom-pipeline-error-handler" class="hash-link" aria-label="Direct link to Implementing a Custom Pipeline Error Handler" title="Direct link to Implementing a Custom Pipeline Error Handler" translate="no">​</a></h4>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.ErrorHandling;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Pipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Pipeline-level error handler for managing node failures.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Demonstrates circuit breaker pattern and restart logic.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed class MyPipelineErrorHandler : IPipelineErrorHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly ILogger _logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly Dictionary&lt;string, int&gt; _nodeRestartAttempts = new();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public MyPipelineErrorHandler(ILogger logger)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger = logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Handles node-level failures that affect entire stream processing.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Implements circuit breaker pattern to prevent infinite restart loops.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Task&lt;PipelineErrorDecision&gt; HandleNodeFailureAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string nodeId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Exception error,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken cancellationToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Track restart attempts for each node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _nodeRestartAttempts.TryGetValue(nodeId, out var attempts);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        attempts++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _nodeRestartAttempts[nodeId] = attempts;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Log failure with context for monitoring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger.LogError(error, &quot;Pipeline-level error in node &#x27;{NodeId}&#x27;: {ErrorMessage}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            nodeId, error.Message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Implement circuit breaker pattern - limit restart attempts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (attempts &lt; 3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _logger.LogInformation(&quot;Attempting to restart node &#x27;{NodeId}&#x27;. Attempt: {Attempt}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                nodeId, attempts);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Task.FromResult(PipelineErrorDecision.RestartNode);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _logger.LogError(&quot;Node &#x27;{NodeId}&#x27; failed too many times, failing pipeline.&quot;, nodeId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Task.FromResult(PipelineErrorDecision.FailPipeline);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="registering-a-pipeline-error-handler">Registering a Pipeline Error Handler<a href="#registering-a-pipeline-error-handler" class="hash-link" aria-label="Direct link to Registering a Pipeline Error Handler" title="Direct link to Registering a Pipeline Error Handler" translate="no">​</a></h4>
<p>You register a pipeline error handler using the <code>AddPipelineErrorHandler</code> method on <code>PipelineBuilder</code>:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.ErrorHandling;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Pipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed class ErrorHandlingPipelineDefinition : IPipelineDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Define(PipelineBuilder builder, PipelineContext context)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var sourceHandle = builder.AddSource&lt;DataSource, string&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var transformHandle = builder.AddTransform&lt;DataTransform, string, string&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var sinkHandle = builder.AddSink&lt;DataSink, string&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.Connect(sourceHandle, transformHandle);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.Connect(transformHandle, sinkHandle);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Configure retry options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.WithRetryOptions(new PipelineRetryOptions(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxItemRetries: 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxNodeRestartAttempts: 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxSequentialNodeAttempts: 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Register the pipeline error handler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.AddPipelineErrorHandler&lt;MyPipelineErrorHandler&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>You also need to register your custom error handler with your DI container:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">services.AddSingleton&lt;IPipelineErrorHandler, MyPipelineErrorHandler&gt;();</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-pipeline-error-handling-scenarios">Common Pipeline Error Handling Scenarios<a href="#common-pipeline-error-handling-scenarios" class="hash-link" aria-label="Direct link to Common Pipeline Error Handling Scenarios" title="Direct link to Common Pipeline Error Handling Scenarios" translate="no">​</a></h4>
<p><strong>Scenario 1: Resource Exhaustion Handling</strong></p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.ErrorHandling;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Pipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Pipeline definition with basic error handling configuration.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Demonstrates how to configure retry options at pipeline level.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed class ErrorHandlingPipelineDefinition : IPipelineDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Define(PipelineBuilder builder, PipelineContext context)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Add nodes to pipeline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var sourceHandle = builder.AddSource&lt;DataSource, string&gt;(&quot;data_source&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var transformHandle = builder.AddTransform&lt;DataTransform, string, string&gt;(&quot;data_transform&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var sinkHandle = builder.AddSink&lt;DataSink, string&gt;(&quot;data_sink&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Connect nodes to define data flow</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.Connect(sourceHandle, transformHandle);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.Connect(transformHandle, sinkHandle);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Configure retry options for resilience</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // These settings control how many times items/nodes can be retried</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.WithRetryOptions(new PipelineRetryOptions(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxItemRetries: 3,           // Retry individual items up to 3 times</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxNodeRestartAttempts: 2,     // Allow node to restart up to 2 times</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxSequentialNodeAttempts: 5     // Limit sequential attempts to prevent infinite loops</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Scenario 2: External Service Dependency Handling</strong></p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.ErrorHandling;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Pipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Node error handler for network-related operations.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Demonstrates transient error handling with retry logic.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class NetworkErrorHandler : INodeErrorHandler&lt;IApiTransformNode, string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly ILogger _logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int _retryCount = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public NetworkErrorHandler(ILogger logger)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger = logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Handles network errors with exponential backoff retry strategy.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Transient errors are retried, persistent failures are redirected.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Task&lt;NodeErrorDecision&gt; HandleAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IApiTransformNode node,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string failedItem,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Exception error,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken cancellationToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Handle network-related errors specifically</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (error is HttpRequestException httpEx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _retryCount++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _logger.LogWarning(&quot;Network error (attempt {RetryCount}): {ErrorMessage}&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                _retryCount, httpEx.Message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Retry up to 3 times for transient network errors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (_retryCount &lt;= 3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return Task.FromResult(NodeErrorDecision.Retry);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // After max retries, reset counter and redirect to dead letter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                _retryCount = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return Task.FromResult(NodeErrorDecision.DeadLetter);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Non-network errors are skipped to continue processing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Task.FromResult(NodeErrorDecision.Skip);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Scenario 3: Data Validation Errors</strong></p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.ErrorHandling;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Pipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Node error handler for data validation scenarios.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Demonstrates how to handle data quality issues separately from system errors.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ValidationErrorHandler : INodeErrorHandler&lt;IValidatorNode, string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly ILogger _logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ValidationErrorHandler(ILogger logger)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger = logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Handles validation errors by redirecting to dead letter queue.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Data quality issues are logged separately from system errors.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Task&lt;NodeErrorDecision&gt; HandleAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IValidatorNode node,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string failedItem,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Exception error,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken cancellationToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Handle validation errors specifically</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (error is ValidationException validationEx)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _logger.LogWarning(&quot;Validation failed for item: {Item}. Error: {Error}&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                failedItem, validationEx.Message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Validation failures indicate data quality issues - redirect for manual review</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Task.FromResult(NodeErrorDecision.DeadLetter);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Other types of errors are skipped to continue processing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Task.FromResult(NodeErrorDecision.Skip);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Scenario 4: Resource Exhaustion Handling</strong></p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.ErrorHandling;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Pipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Pipeline error handler for resource exhaustion scenarios.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Demonstrates critical error handling for system resource issues.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ResourceExhaustionHandler : IPipelineErrorHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly ILogger _logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly Dictionary&lt;string, int&gt; _nodeFailureCounts = new();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResourceExhaustionHandler(ILogger logger)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger = logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Handles resource exhaustion by failing fast to prevent system damage.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Critical resource errors should immediately terminate processing.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Task&lt;PipelineErrorDecision&gt; HandleNodeFailureAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string nodeId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Exception error,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken cancellationToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Track failure count for each node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _nodeFailureCounts.TryGetValue(nodeId, out var count);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _nodeFailureCounts[nodeId] = count + 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Handle critical resource errors immediately</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (error is OutOfMemoryException or InsufficientMemoryException)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _logger.LogCritical(&quot;Resource exhaustion in node &#x27;{NodeId}&#x27;: {Error}&quot;, nodeId, error.Message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Task.FromResult(PipelineErrorDecision.FailPipeline);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // For other errors, allow limited restarts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (_nodeFailureCounts[nodeId] &lt;= 3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _logger.LogWarning(&quot;Restarting node &#x27;{NodeId}&#x27; (attempt {Attempt})&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                nodeId, _nodeFailureCounts[nodeId]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Task.FromResult(PipelineErrorDecision.RestartNode);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Too many failures - continue without the problematic node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger.LogError(&quot;Node &#x27;{NodeId}&#x27; failed too many times, continuing without it&quot;, nodeId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Task.FromResult(PipelineErrorDecision.ContinueWithoutNode);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Scenario 5: Production-ready Node Error Handler with Metrics Integration</strong></p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.ErrorHandling;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Pipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Production-ready node error handler with metrics integration.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Demonstrates comprehensive error handling with observability.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ProductionNodeErrorHandler : INodeErrorHandler&lt;ITransformNode&lt;string, string&gt;, string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly ILogger _logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly IMetrics _metrics;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ProductionNodeErrorHandler(ILogger logger, IMetrics metrics)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger = logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _metrics = metrics;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Handles errors with comprehensive logging and metrics collection.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Enables monitoring and alerting for production environments.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Task&lt;NodeErrorDecision&gt; HandleAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ITransformNode&lt;string, string&gt; node,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string failedItem,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Exception error,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken cancellationToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Record error metrics for monitoring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _metrics.Increment(&quot;node_errors&quot;, new[] { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new KeyValuePair&lt;string, object&gt;(&quot;node_type&quot;, node.GetType().Name),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new KeyValuePair&lt;string, object&gt;(&quot;error_type&quot;, error.GetType().Name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Log error with full context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger.LogError(error, &quot;Error processing item in node {NodeName}&quot;, node.Name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Implement error handling strategy based on exception type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return error switch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Data validation errors - redirect to dead letter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ValidationException =&gt; Task.FromResult(NodeErrorDecision.DeadLetter),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Transient errors - retry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TimeoutException =&gt; Task.FromResult(NodeErrorDecision.Retry),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HttpRequestException =&gt; Task.FromResult(NodeErrorDecision.Retry),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // All other errors - skip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; Task.FromResult(NodeErrorDecision.Skip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Production-ready pipeline error handler with circuit breaker pattern.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// Demonstrates sophisticated error handling for production environments.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ProductionPipelineErrorHandler : IPipelineErrorHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly ILogger _logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly Dictionary&lt;string, int&gt; _failureCounts = new();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ProductionPipelineErrorHandler(ILogger logger)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger = logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Handles node failures with circuit breaker pattern.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Prevents cascading failures by limiting restart attempts.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Task&lt;PipelineErrorDecision&gt; HandleNodeFailureAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string nodeId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Exception error,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken cancellationToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Track failure count for circuit breaker logic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _failureCounts.TryGetValue(nodeId, out var count);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _failureCounts[nodeId] = count + 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Log failure for monitoring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger.LogError(error, &quot;Node {NodeId} failed (attempt {Attempt})&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            nodeId, _failureCounts[nodeId]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Implement circuit breaker based on error type and count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return error switch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Critical resource errors - fail immediately</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            OutOfMemoryException =&gt; Task.FromResult(PipelineErrorDecision.FailPipeline),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Transient errors - allow limited restarts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ when _failureCounts[nodeId] &lt; 3 =&gt; Task.FromResult(PipelineErrorDecision.RestartNode),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Persistent failures - continue without node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; Task.FromResult(PipelineErrorDecision.ContinueWithoutNode)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="error-flow-diagram">Error Flow Diagram<a href="#error-flow-diagram" class="hash-link" aria-label="Direct link to Error Flow Diagram" title="Direct link to Error Flow Diagram" translate="no">​</a></h3>
<!-- -->
<p><em>Figure: Error handling flow in NPipeline showing the decision tree for both node-level and pipeline-level error handling, including retry logic, circuit breaker behavior, and dead letter queue routing.</em></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuration-examples">Configuration Examples<a href="#configuration-examples" class="hash-link" aria-label="Direct link to Configuration Examples" title="Direct link to Configuration Examples" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="basic-error-handling-configuration">Basic Error Handling Configuration<a href="#basic-error-handling-configuration" class="hash-link" aria-label="Direct link to Basic Error Handling Configuration" title="Direct link to Basic Error Handling Configuration" translate="no">​</a></h3>
<p>To get started with error handling, you can configure basic error handling directly in your pipeline definition:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.ErrorHandling;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Pipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Example 1: Basic error handling with default retry options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed class ErrorHandlingPipelineDefinition : IPipelineDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Define(PipelineBuilder builder, PipelineContext context)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var sourceHandle = builder.AddSource&lt;DataSource, string&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var transformHandle = builder.AddTransform&lt;DataTransform, string, string&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var sinkHandle = builder.AddSink&lt;DataSink, string&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.Connect(sourceHandle, transformHandle);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.Connect(transformHandle, sinkHandle);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Configure retry options using PipelineRetryOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.WithRetryOptions(new PipelineRetryOptions(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxItemRetries: 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxNodeRestartAttempts: 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxSequentialNodeAttempts: 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static class Program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static async Task Main(string[] args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var runner = new PipelineRunner();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var context = PipelineContext.Default;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var pipeline = PipelineBuilder.Create&lt;ErrorHandlingPipelineDefinition&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await runner.RunAsync&lt;ErrorHandlingPipelineDefinition&gt;(context);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="production-ready-error-handling-example">Production-Ready Error Handling Example<a href="#production-ready-error-handling-example" class="hash-link" aria-label="Direct link to Production-Ready Error Handling Example" title="Direct link to Production-Ready Error Handling Example" translate="no">​</a></h3>
<p>Here&#x27;s a complete example that combines all error handling concepts:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.ErrorHandling;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Pipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 1. Define custom error handlers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ProductionNodeErrorHandler : INodeErrorHandler&lt;ITransformNode&lt;string, string&gt;, string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly ILogger _logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly IMetrics _metrics;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ProductionNodeErrorHandler(ILogger logger, IMetrics metrics)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger = logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _metrics = metrics;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Handles errors with comprehensive logging and metrics collection.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Enables monitoring and alerting for production environments.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Task&lt;NodeErrorDecision&gt; HandleAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ITransformNode&lt;string, string&gt; node,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string failedItem,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Exception error,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken cancellationToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Record error metrics for monitoring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _metrics.Increment(&quot;node_errors&quot;, new[] { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new KeyValuePair&lt;string, object&gt;(&quot;node_type&quot;, node.GetType().Name),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new KeyValuePair&lt;string, object&gt;(&quot;error_type&quot;, error.GetType().Name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Log error with full context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger.LogError(error, &quot;Error processing item in node {NodeName}&quot;, node.Name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Implement error handling strategy based on exception type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return error switch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Data validation errors - redirect to dead letter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ValidationException =&gt; Task.FromResult(NodeErrorDecision.DeadLetter),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Transient errors - retry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TimeoutException =&gt; Task.FromResult(NodeErrorDecision.Retry),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HttpRequestException =&gt; Task.FromResult(NodeErrorDecision.Retry),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // All other errors - skip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; Task.FromResult(NodeErrorDecision.Skip)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ProductionPipelineErrorHandler : IPipelineErrorHandler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly ILogger _logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly Dictionary&lt;string, int&gt; _failureCounts = new();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ProductionPipelineErrorHandler(ILogger logger)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger = logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Handles node failures with circuit breaker pattern.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// Prevents cascading failures by limiting restart attempts.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /// &lt;/summary&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Task&lt;PipelineErrorDecision&gt; HandleNodeFailureAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string nodeId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Exception error,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken cancellationToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Track failure count for circuit breaker logic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _failureCounts.TryGetValue(nodeId, out var count);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _failureCounts[nodeId] = count + 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Log failure for monitoring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _logger.LogError(error, &quot;Node {NodeId} failed (attempt {Attempt})&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            nodeId, _failureCounts[nodeId]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Implement circuit breaker based on error type and count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return error switch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Critical resource errors - fail immediately</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            OutOfMemoryException =&gt; Task.FromResult(PipelineErrorDecision.FailPipeline),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Transient errors - allow limited restarts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ when _failureCounts[nodeId] &lt; 3 =&gt; Task.FromResult(PipelineErrorDecision.RestartNode),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Persistent failures - continue without node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; Task.FromResult(PipelineErrorDecision.ContinueWithoutNode)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 2. Configure the pipeline with comprehensive error handling</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed class ProductionPipelineDefinition : IPipelineDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Define(PipelineBuilder builder, PipelineContext context)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var sourceHandle = builder.AddSource&lt;DataSource, string&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var transformHandle = builder.AddTransform&lt;DataTransform, string, string&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var sinkHandle = builder.AddSink&lt;DataSink, string&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.Connect(sourceHandle, transformHandle);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.Connect(transformHandle, sinkHandle);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Configure retry options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.WithRetryOptions(new PipelineRetryOptions(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxItemRetries: 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxNodeRestartAttempts: 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxSequentialNodeAttempts: 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static class Program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static async Task Main(string[] args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var runner = new PipelineRunner();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Configure retry options at context level</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var retryOptions = new PipelineRetryOptions(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxItemRetries: 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxNodeRestartAttempts: 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MaxSequentialNodeAttempts: 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var context = PipelineContext.WithRetry(retryOptions);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var pipeline = PipelineBuilder.Create&lt;ProductionPipelineDefinition&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Configure error handlers through the pipeline runner or register via dependency injection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // The PipelineErrorHandler can be registered in the service container:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var serviceProvider = new ServiceCollection()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddSingleton&lt;IPipelineErrorHandler, ProductionPipelineErrorHandler&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddSingleton&lt;INodeErrorHandler&lt;ITransformNode&lt;string, string&gt;, string&gt;, ProductionNodeErrorHandler&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddSingleton&lt;IDeadLetterSink, FileDeadLetterSink&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .BuildServiceProvider();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var runner = new PipelineRunner();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await runner.RunAsync&lt;ProductionPipelineDefinition&gt;(context);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="retry-options-precedence">Retry Options Precedence<a href="#retry-options-precedence" class="hash-link" aria-label="Direct link to Retry Options Precedence" title="Direct link to Retry Options Precedence" translate="no">​</a></h3>
<p>NPipeline follows a clear precedence order when determining which retry options to use:</p>
<ol>
<li class=""><strong>Node-specific options</strong>: Options set directly on a specific node using <code>WithRetryOptions(nodeHandle, options)</code></li>
<li class=""><strong>Graph-level options</strong>: Options set at the pipeline level using <code>builder.WithRetryOptions(options)</code></li>
<li class=""><strong>Context-level options</strong>: Options provided through <code>PipelineContext(retryOptions: options)</code></li>
</ol>
<p>This hierarchy allows for fine-grained control where you can:</p>
<ul>
<li class="">Override retry behavior for specific nodes that need special handling</li>
<li class="">Set default behavior for the entire pipeline</li>
<li class="">Provide runtime options through the context</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="propagating-contextual-information">Propagating Contextual Information<a href="#propagating-contextual-information" class="hash-link" aria-label="Direct link to Propagating Contextual Information" title="Direct link to Propagating Contextual Information" translate="no">​</a></h3>
<p>The <a class="" href="/src/NPipeline/PipelineContext.cs"><code>PipelineContext</code></a> can be invaluable for error handling. You can store error-specific information, such as correlation IDs, loggers, or even error reporting services, within the context, making them accessible to any node that needs to handle or report an error.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="node-level-error-handling-best-practices">Node-level Error Handling Best Practices<a href="#node-level-error-handling-best-practices" class="hash-link" aria-label="Direct link to Node-level Error Handling Best Practices" title="Direct link to Node-level Error Handling Best Practices" translate="no">​</a></h3>
<ol>
<li class="">
<p><strong>Be specific about error types</strong>: Different error types should be handled differently. Transient errors (like network issues) might be worth retrying, while data validation errors should probably be redirected.</p>
</li>
<li class="">
<p><strong>Implement retry limits</strong>: Always limit the number of retries to prevent infinite loops and resource exhaustion.</p>
</li>
<li class="">
<p><strong>Log detailed error information</strong>: Include sufficient context in your error logs to help with troubleshooting.</p>
</li>
<li class="">
<p><strong>Use dead-letter queues for problematic items</strong>: Items that consistently fail should be redirected to a dead-letter queue for later analysis.</p>
</li>
<li class="">
<p><strong>Consider performance implications</strong>: Error handling logic adds overhead to normal processing, so keep it efficient.</p>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pipeline-level-error-handling-best-practices">Pipeline-level Error Handling Best Practices<a href="#pipeline-level-error-handling-best-practices" class="hash-link" aria-label="Direct link to Pipeline-level Error Handling Best Practices" title="Direct link to Pipeline-level Error Handling Best Practices" translate="no">​</a></h3>
<ol>
<li class="">
<p><strong>Track failure patterns</strong>: Keep track of when and how often nodes fail to detect persistent issues.</p>
</li>
<li class="">
<p><strong>Implement circuit breaker patterns</strong>: Prevent cascading failures by temporarily stopping attempts to failing nodes.</p>
</li>
<li class="">
<p><strong>Differentiate between error types</strong>: Critical errors should fail the pipeline immediately, while transient errors might be worth retrying.</p>
</li>
<li class="">
<p><strong>Set reasonable limits</strong>: Prevent infinite restarts by setting limits on the number of restart attempts.</p>
</li>
<li class="">
<p><strong>Monitor and alert</strong>: Implement proper monitoring and alerting for pipeline failures.</p>
</li>
<li class="">
<p><strong>Consider graceful degradation</strong>: Design your pipeline to continue functioning even when some nodes fail.</p>
</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="warning-dependency-chain-requirements">⚠️<!-- --> Dependency Chain Requirements<a href="#warning-dependency-chain-requirements" class="hash-link" aria-label="Direct link to warning-dependency-chain-requirements" title="Direct link to warning-dependency-chain-requirements" translate="no">​</a></h2>
<p>For resilience features like <code>PipelineErrorDecision.RestartNode</code> to work properly, you must understand the dependency chain between components. See <a class="" href="/docs/core-concepts/resilience/dependency-chains">Dependency Chains</a> in the resilience section for detailed prerequisites.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="see-also">See Also<a href="#see-also" class="hash-link" aria-label="Direct link to See Also" title="Direct link to See Also" translate="no">​</a></h2>
<ul>
<li class=""><a class="" href="/docs/core-concepts/resilience/retry-configuration">Retry Configuration</a> - Detailed retry policy configuration</li>
<li class=""><a class="" href="/docs/core-concepts/resilience/circuit-breaker-configuration">Circuit Breaker Configuration</a> - Circuit breaker patterns and settings</li>
<li class=""><a class="" href="/docs/core-concepts/resilience/node-restart-quickstart">Node Restart Quickstart</a> - Quick guide to node restart functionality</li>
<li class=""><a class="" href="/docs/core-concepts/resilience/execution-with-resilience">Execution with Resilience</a> - Adding resilience to execution strategies</li>
<li class=""><a class="" href="/docs/core-concepts/resilience/dependency-chains">Dependency Chains</a> - Critical prerequisite relationships for resilience features</li>
<li class=""><a class="" href="/docs/core-concepts/resilience/configuration-guide">Configuration Guide</a> - Comprehensive configuration options</li>
<li class=""><a class="" href="/docs/core-concepts/resilience/troubleshooting">Troubleshooting</a> - Common error handling issues and solutions</li>
<li class=""><a class="" href="/docs/reference/error-codes">Error Codes Reference</a> - Complete error code reference</li>
<li class=""><a class="" href="/docs/core-concepts/pipeline-execution/execution-strategies">Execution Strategies</a> - How error handling integrates with execution</li>
<li class=""><a class="" href="/docs/core-concepts/pipelinebuilder">PipelineBuilder</a> - Configuring error handling during pipeline construction</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps" translate="no">​</a></h2>
<ul>
<li class=""><a class="" href="/docs/core-concepts/resilience/execution-with-resilience">Execution with Resilience</a> - Learn how to wrap execution strategies with error handling</li>
<li class=""><a class="" href="/docs/core-concepts/resilience/retry-configuration">Retry Configuration</a> - Configure detailed retry policies</li>
<li class=""><a class="" href="/docs/core-concepts/resilience/circuit-breaker-configuration">Circuit Breaker Configuration</a> - Implement circuit breaker patterns</li>
<li class=""><a class="" href="/docs/advanced-topics/testing-pipelines">Testing Resilient Pipelines</a> - Test your error handling strategies</li>
</ul></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/core-concepts/resilience/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Resilience Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/core-concepts/resilience/execution-with-resilience"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Execution with Resilience</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#choosing-your-error-handling-approach" class="table-of-contents__link toc-highlight">Choosing Your Error Handling Approach</a></li><li><a href="#error-handling-levels" class="table-of-contents__link toc-highlight">Error Handling Levels</a><ul><li><a href="#node-level-error-handling" class="table-of-contents__link toc-highlight">Node-Level Error Handling</a></li><li><a href="#pipeline-level-error-handling" class="table-of-contents__link toc-highlight">Pipeline-Level Error Handling</a></li><li><a href="#error-flow-diagram" class="table-of-contents__link toc-highlight">Error Flow Diagram</a></li></ul></li><li><a href="#configuration-examples" class="table-of-contents__link toc-highlight">Configuration Examples</a><ul><li><a href="#basic-error-handling-configuration" class="table-of-contents__link toc-highlight">Basic Error Handling Configuration</a></li><li><a href="#production-ready-error-handling-example" class="table-of-contents__link toc-highlight">Production-Ready Error Handling Example</a></li><li><a href="#retry-options-precedence" class="table-of-contents__link toc-highlight">Retry Options Precedence</a></li><li><a href="#propagating-contextual-information" class="table-of-contents__link toc-highlight">Propagating Contextual Information</a></li></ul></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a><ul><li><a href="#node-level-error-handling-best-practices" class="table-of-contents__link toc-highlight">Node-level Error Handling Best Practices</a></li><li><a href="#pipeline-level-error-handling-best-practices" class="table-of-contents__link toc-highlight">Pipeline-level Error Handling Best Practices</a></li></ul></li><li><a href="#warning-dependency-chain-requirements" class="table-of-contents__link toc-highlight">⚠️ Dependency Chain Requirements</a></li><li><a href="#see-also" class="table-of-contents__link toc-highlight">See Also</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/why-npipeline">Why NPipeline?</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/installation">Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/quick-start">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/core-concepts">Core Concepts</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/npipeline/npipeline" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">&nbsp;</div></div></div></footer></div>
</body>
</html>