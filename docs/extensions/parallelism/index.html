<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-extensions/parallelism" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Parallelism | NPipeline</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://npipeline.dev/docs/extensions/parallelism"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Parallelism | NPipeline"><meta data-rh="true" name="description" content="Enhance your NPipeline&#x27;s performance by leveraging parallel processing capabilities."><meta data-rh="true" property="og:description" content="Enhance your NPipeline&#x27;s performance by leveraging parallel processing capabilities."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://npipeline.dev/docs/extensions/parallelism"><link data-rh="true" rel="alternate" href="https://npipeline.dev/docs/extensions/parallelism" hreflang="en"><link data-rh="true" rel="alternate" href="https://npipeline.dev/docs/extensions/parallelism" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Extensions","item":"https://npipeline.dev/docs/extensions"},{"@type":"ListItem","position":2,"name":"Parallelism","item":"https://npipeline.dev/docs/extensions/parallelism"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="NPipeline RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="NPipeline Atom Feed">





<script src="//script.crazyegg.com/pages/scripts/0131/6841.js" async="async"></script><link rel="stylesheet" href="/assets/css/styles.4bb8ba71.css">
<script src="/assets/js/runtime~main.0b0433af.js" defer="defer"></script>
<script src="/assets/js/main.9033d170.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="NPipeline logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="NPipeline logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">NPipeline</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/npipeline/npipeline" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/"><span title="Welcome to NPipeline" class="linkLabel_WmDU">Welcome to NPipeline</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/category/getting-started"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a><button aria-label="Expand sidebar category &#x27;Getting Started&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/core-concepts"><span title="Core Concepts" class="categoryLinkLabel_W154">Core Concepts</span></a><button aria-label="Expand sidebar category &#x27;Core Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/architecture/"><span title="Architecture" class="categoryLinkLabel_W154">Architecture</span></a><button aria-label="Collapse sidebar category &#x27;Architecture&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/architectural-foundations"><span title="Architectural Foundations" class="linkLabel_WmDU">Architectural Foundations</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/component-architecture"><span title="Component Architecture" class="linkLabel_WmDU">Component Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/execution-flow"><span title="Execution Flow" class="linkLabel_WmDU">Execution Flow</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/data-flow"><span title="Data Flow Details" class="linkLabel_WmDU">Data Flow Details</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/dependency-injection"><span title="Dependency Injection Integration" class="linkLabel_WmDU">Dependency Injection Integration</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/node-instantiation"><span title="Node Instantiation" class="linkLabel_WmDU">Node Instantiation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/error-handling-architecture"><span title="Error Handling Architecture" class="linkLabel_WmDU">Error Handling Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/cancellation-model"><span title="Cancellation Model" class="linkLabel_WmDU">Cancellation Model</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/performance-characteristics"><span title="Performance Characteristics" class="linkLabel_WmDU">Performance Characteristics</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/retry-delay-architecture"><span title="Retry Delay Strategies Architecture" class="linkLabel_WmDU">Retry Delay Strategies Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/extension-points"><span title="Extension Points" class="linkLabel_WmDU">Extension Points</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/design-principles"><span title="Design Principles" class="linkLabel_WmDU">Design Principles</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/optimization-principles"><span title="Optimization Principles - How NPipeline Achieves High Performance" class="linkLabel_WmDU">Optimization Principles - How NPipeline Achieves High Performance</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/architecture/execution-plan-caching"><span title="Execution Plan Caching" class="linkLabel_WmDU">Execution Plan Caching</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/docs/extensions"><span title="Extensions" class="categoryLinkLabel_W154">Extensions</span></a><button aria-label="Collapse sidebar category &#x27;Extensions&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/extensions/dependency-injection"><span title="Dependency Injection" class="linkLabel_WmDU">Dependency Injection</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/extensions/parallelism"><span title="Parallelism" class="linkLabel_WmDU">Parallelism</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/docs/extensions/testing"><span title="Testing" class="categoryLinkLabel_W154">Testing</span></a><button aria-label="Expand sidebar category &#x27;Testing&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/connectors"><span title="Connectors" class="categoryLinkLabel_W154">Connectors</span></a><button aria-label="Expand sidebar category &#x27;Connectors&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/advanced-topics"><span title="Advanced Topics" class="categoryLinkLabel_W154">Advanced Topics</span></a><button aria-label="Expand sidebar category &#x27;Advanced Topics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/analyzers/"><span title="Build-Time Analyzers" class="categoryLinkLabel_W154">Build-Time Analyzers</span></a><button aria-label="Expand sidebar category &#x27;Build-Time Analyzers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/samples/"><span title="Samples" class="categoryLinkLabel_W154">Samples</span></a><button aria-label="Expand sidebar category &#x27;Samples&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/docs/category/reference"><span title="Reference" class="categoryLinkLabel_W154">Reference</span></a><button aria-label="Expand sidebar category &#x27;Reference&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/extensions"><span>Extensions</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Parallelism</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Parallelism</h1></header>
<p>NPipeline is designed for high performance, and a key aspect of this is its ability to execute parts of your pipeline in parallel. The <a class="" href="/src/NPipeline.Extensions.Parallelism/NPipeline.Extensions.Parallelism.csproj"><code>NPipeline.Extensions.Parallelism</code></a> package provides tools and extensions to easily introduce parallel processing into your data flows, allowing you to scale out your computations and maximize throughput.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-parallelism-in-npipeline">Understanding Parallelism in NPipeline<a href="#understanding-parallelism-in-npipeline" class="hash-link" aria-label="Direct link to Understanding Parallelism in NPipeline" title="Direct link to Understanding Parallelism in NPipeline" translate="no">​</a></h2>
<p>Parallelism in NPipeline typically means processing multiple data items concurrently, either within a single node or across multiple independent branches of a pipeline. This is distinct from concurrency, which is about managing multiple tasks that may or may not run simultaneously.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="npipelineextensionsparallelism"><a class="" href="/src/NPipeline.Extensions.Parallelism/NPipeline.Extensions.Parallelism.csproj"><code>NPipeline.Extensions.Parallelism</code></a><a href="#npipelineextensionsparallelism" class="hash-link" aria-label="Direct link to npipelineextensionsparallelism" title="Direct link to npipelineextensionsparallelism" translate="no">​</a></h2>
<p>This extension package provides the <a class="" href="/src/NPipeline.Extensions.Parallelism/ParallelExecutionStrategy.cs"><code>ParallelExecutionStrategy</code></a> class and builder extensions to enable and manage parallel execution.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="important-thread-safety">Important: Thread Safety<a href="#important-thread-safety" class="hash-link" aria-label="Direct link to Important: Thread Safety" title="Direct link to Important: Thread Safety" translate="no">​</a></h3>
<p>When using parallel execution, it&#x27;s critical to understand NPipeline&#x27;s thread-safety model. Each worker thread processes <strong>independent data items</strong>—the <code>PipelineContext</code> itself is not shared across threads. However, if your nodes need to access shared state during parallel execution, you must use thread-safe mechanisms.</p>
<p><strong>See <a class="" href="/docs/core-concepts/thread-safety">Thread Safety Guidelines</a> for detailed guidance on:</strong></p>
<ul>
<li class="">Safe patterns for accessing context during parallel execution</li>
<li class="">Using <code>IPipelineStateManager</code> for shared state</li>
<li class="">Node-level synchronization strategies</li>
<li class="">When and how to use atomic operations</li>
</ul>
<p>This is essential reading if your parallel nodes interact with shared state.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-parallel-transform">Example: Parallel Transform<a href="#example-parallel-transform" class="hash-link" aria-label="Direct link to Example: Parallel Transform" title="Direct link to Example: Parallel Transform" translate="no">​</a></h3>
<p>Imagine you have a computationally intensive transformation that can be applied independently to each item. You can use parallel execution to process multiple items simultaneously.</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Extensions.Parallelism;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Extensions.Testing;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Execution;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Nodes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed class IntensiveTransform : TransformNode&lt;int, int&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override async Task&lt;int&gt; ExecuteAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int item,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken cancellationToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var logger = context.LoggerFactory.CreateLogger(&quot;IntensiveTransform&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger.Log(NPipeline.Observability.Logging.LogLevel.Information,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $&quot;Processing item {item} on Thread {Environment.CurrentManagedThreadId}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await Task.Delay(100, cancellationToken); // Simulate intensive work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return item * 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed class ParallelPipeline : IPipelineDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Define(PipelineBuilder builder, PipelineContext context)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var source = builder.AddInMemorySource&lt;int&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var transform = builder.AddTransform&lt;IntensiveTransform, int, int&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var sink = builder.AddInMemorySink&lt;int&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.Connect(source, transform);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.Connect(transform, sink);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Configure parallel execution for the transform</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.WithParallelOptions(transform,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new ParallelOptions { MaxDegreeOfParallelism = 4 });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Set execution strategy to ParallelExecutionStrategy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        transform.NodeDefinition.ExecutionConfig.ExecutionStrategy = new ParallelExecutionStrategy();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static class Program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static async Task Main(string[] args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Set up test data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var testData = new[] { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var context = new PipelineContext();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context.SetSourceData(testData);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Console.WriteLine(&quot;Starting parallel pipeline...&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var runner = PipelineRunner.Create();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await runner.RunAsync&lt;ParallelPipeline&gt;(context);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Console.WriteLine(&quot;Parallel pipeline finished.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>In this example, we:</p>
<ol>
<li class="">Use <a class="" href="/src/NPipeline.Extensions.Parallelism/ParallelOptions.cs:47"><code>WithParallelOptions(transform, new ParallelOptions { MaxDegreeOfParallelism = 4 })</code></a> to configure parallel execution options for the transform</li>
<li class="">Set the <a class="" href="/src/NPipeline/Graph/NodeDefinition.cs"><code>ExecutionStrategy</code></a> property to <a class="" href="/src/NPipeline.Extensions.Parallelism/ParallelExecutionStrategy.cs"><code>ParallelExecutionStrategy</code></a> to enable parallel processing</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="non-ordered-parallel-execution-for-maximum-throughput">Non-Ordered Parallel Execution for Maximum Throughput<a href="#non-ordered-parallel-execution-for-maximum-throughput" class="hash-link" aria-label="Direct link to Non-Ordered Parallel Execution for Maximum Throughput" title="Direct link to Non-Ordered Parallel Execution for Maximum Throughput" translate="no">​</a></h2>
<p>By default, NPipeline preserves the order of items even when processing them in parallel. While this ensures predictable output, it can introduce overhead that reduces throughput. When the order of output items is not important for your use case, you can configure parallel execution to not preserve order, which can significantly increase throughput.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-non-ordered-parallel-processing">Example: Non-Ordered Parallel Processing<a href="#example-non-ordered-parallel-processing" class="hash-link" aria-label="Direct link to Example: Non-Ordered Parallel Processing" title="Direct link to Example: Non-Ordered Parallel Processing" translate="no">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Extensions.Parallelism;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Extensions.Testing;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Execution;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Nodes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Pipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed class IntensiveTransform : TransformNode&lt;int, int&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override async Task&lt;int&gt; ExecuteAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int item,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken cancellationToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var logger = context.LoggerFactory.CreateLogger(&quot;IntensiveTransform&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger.Log(NPipeline.Observability.Logging.LogLevel.Information,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            $&quot;Processing item {item} on Thread {Environment.CurrentManagedThreadId}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await Task.Delay(new Random().Next(50, 150), cancellationToken); // Simulate variable work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return item * 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed class NonOrderedParallelPipeline : IPipelineDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void Define(PipelineBuilder builder, PipelineContext context)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var source = builder.AddInMemorySource&lt;int&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var transform = builder.AddTransform&lt;IntensiveTransform, int, int&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var sink = builder.AddInMemorySink&lt;int&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.Connect(source, transform);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.Connect(transform, sink);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Configure parallel execution with non-ordered output for maximum throughput</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.WithParallelOptions(transform,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new ParallelOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                MaxDegreeOfParallelism = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                PreserveOrdering = false  // Disable ordering to maximize throughput</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Set execution strategy to ParallelExecutionStrategy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        transform.NodeDefinition.ExecutionConfig.ExecutionStrategy = new ParallelExecutionStrategy();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static class Program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static async Task Main(string[] args)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Set up test data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var testData = new[] { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var context = new PipelineContext();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context.SetSourceData(testData);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Console.WriteLine(&quot;Starting non-ordered parallel pipeline...&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var runner = PipelineRunner.Create();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await runner.RunAsync&lt;NonOrderedParallelPipeline&gt;(context);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Console.WriteLine(&quot;Non-ordered parallel pipeline finished.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>In this example, we explicitly set <code>PreserveOrdering = false</code> in the <a class="" href="/src/NPipeline.Extensions.Parallelism/ParallelOptions.cs:34"><code>ParallelOptions</code></a>. This configuration:</p>
<ol>
<li class="">Allows items to be emitted as soon as they are processed, without waiting for slower items</li>
<li class="">Eliminates the overhead of tracking and reordering items</li>
<li class="">Can significantly increase throughput, especially when processing times vary widely</li>
<li class="">Results in output that may not match the input order</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="when-to-use-non-ordered-execution">When to Use Non-Ordered Execution<a href="#when-to-use-non-ordered-execution" class="hash-link" aria-label="Direct link to When to Use Non-Ordered Execution" title="Direct link to When to Use Non-Ordered Execution" translate="no">​</a></h3>
<p>Consider using <code>PreserveOrdering = false</code> when:</p>
<ul>
<li class=""><strong>Order is irrelevant</strong>: Your downstream processing doesn&#x27;t depend on the input order</li>
<li class=""><strong>Maximum throughput is critical</strong>: You need to process as many items as possible per unit of time</li>
<li class=""><strong>Processing times vary significantly</strong>: Some items take much longer to process than others</li>
<li class=""><strong>You&#x27;re aggregating results</strong>: You&#x27;re collecting statistics or aggregating data where order doesn&#x27;t matter</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="trade-offs">Trade-offs<a href="#trade-offs" class="hash-link" aria-label="Direct link to Trade-offs" title="Direct link to Trade-offs" translate="no">​</a></h3>
<table><thead><tr><th>Aspect</th><th>PreserveOrdering: true (Default)</th><th>PreserveOrdering: false</th></tr></thead><tbody><tr><td><strong>Throughput</strong></td><td>Good</td><td>Excellent</td></tr><tr><td><strong>Output Order</strong></td><td>Matches input order</td><td>May be out of order</td></tr><tr><td><strong>Memory Usage</strong></td><td>Higher (needs to buffer)</td><td>Lower</td></tr><tr><td><strong>Latency</strong></td><td>Higher (waits for slow items)</td><td>Lower (emits immediately)</td></tr><tr><td><strong>Use Case</strong></td><td>Order-sensitive processing</td><td>Maximum throughput scenarios</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="advanced-parallel-options">Advanced Parallel Options<a href="#advanced-parallel-options" class="hash-link" aria-label="Direct link to Advanced Parallel Options" title="Direct link to Advanced Parallel Options" translate="no">​</a></h2>
<p>The <a class="" href="/src/NPipeline.Extensions.Parallelism/ParallelOptions.cs:34"><code>ParallelOptions</code></a> class provides additional configuration options for fine-tuning parallel execution:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var options = new ParallelOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MaxDegreeOfParallelism = 8,           // Maximum concurrent operations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MaxQueueLength = 1000,               // Bounded input queue for backpressure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    QueuePolicy = BoundedQueuePolicy.Block, // Behavior when queue is full</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    OutputBufferCapacity = 500,           // Bounded output buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PreserveOrdering = true,              // Whether to preserve input order</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MetricsInterval = TimeSpan.FromSeconds(1) // Interval for metrics emission</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="metrics-configuration">Metrics Configuration<a href="#metrics-configuration" class="hash-link" aria-label="Direct link to Metrics Configuration" title="Direct link to Metrics Configuration" translate="no">​</a></h3>
<p>The <a class="" href="/src/NPipeline.Extensions.Parallelism/ParallelOptions.cs:45"><code>MetricsInterval</code></a> property controls how frequently parallel execution metrics are emitted:</p>
<ul>
<li class=""><strong>Default value</strong>: 1 second</li>
<li class=""><strong>Purpose</strong>: Determines the interval at which performance metrics (throughput, queue depth, worker utilization) are collected and reported</li>
<li class=""><strong>When to adjust</strong>:<!-- -->
<ul>
<li class="">Decrease for more granular monitoring in high-frequency trading or real-time analytics</li>
<li class="">Increase to reduce monitoring overhead in batch processing scenarios</li>
<li class="">Set to longer intervals when using custom metrics collection systems that batch data</li>
</ul>
</li>
</ul>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Example: Fine-grained monitoring for real-time systems</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var realtimeOptions = new ParallelOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MaxDegreeOfParallelism = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MetricsInterval = TimeSpan.FromMilliseconds(500) // Emit metrics every 500ms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Example: Reduced monitoring overhead for batch processing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var batchOptions = new ParallelOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MaxDegreeOfParallelism = 8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MetricsInterval = TimeSpan.FromSeconds(10) // Emit metrics every 10 seconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="queue-policies">Queue Policies<a href="#queue-policies" class="hash-link" aria-label="Direct link to Queue Policies" title="Direct link to Queue Policies" translate="no">​</a></h3>
<p>When <code>MaxQueueLength</code> is specified, you can control the behavior when the queue reaches its capacity:</p>
<ul>
<li class=""><strong><code>BoundedQueuePolicy.Block</code></strong>: Wait until space becomes available (default)</li>
<li class=""><strong><code>BoundedQueuePolicy.DropNewest</code></strong>: Drop the incoming item</li>
<li class=""><strong><code>BoundedQueuePolicy.DropOldest</code></strong>: Remove the oldest item to make space</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="default-queue-length">Default Queue Length<a href="#default-queue-length" class="hash-link" aria-label="Direct link to Default Queue Length" title="Direct link to Default Queue Length" translate="no">​</a></h3>
<p>The <a class="" href="/src/NPipeline.Extensions.Parallelism/ParallelNodeConfigurationExtensions.cs:27"><code>ParallelNodeConfigurationExtensions.DefaultQueueLength</code></a> constant defines the default queue length for bounded parallel execution strategies:</p>
<ul>
<li class=""><strong>Default value</strong>: 100 items</li>
<li class=""><strong>Applied to</strong>: Drop-oldest and drop-newest parallel strategies when no explicit queue length is provided</li>
<li class=""><strong>Rationale</strong>: This value balances memory usage with throughput, providing sufficient buffer for most workloads while preventing excessive memory consumption</li>
</ul>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Example: Using default queue length (100)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var transform = builder.AddTransform&lt;MyTransform, int, string&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .WithDropOldestParallelism(builder, maxDegreeOfParallelism: 4);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Uses DefaultQueueLength of 100 automatically</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Example: Custom queue length for high-volume scenarios</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var highVolumeTransform = builder.AddTransform&lt;MyTransform, int, string&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .WithDropOldestParallelism(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxDegreeOfParallelism: 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maxQueueLength: 1000); // Override default with larger queue</span><br></span></code></pre></div></div>
<p>When to adjust the default queue length:</p>
<ul>
<li class=""><strong>Increase</strong> for high-throughput scenarios with bursty input patterns</li>
<li class=""><strong>Decrease</strong> for memory-constrained environments or when processing large items</li>
<li class=""><strong>Keep default</strong> for most typical workloads where balanced performance is desired</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="thread-safety-in-parallel-execution">Thread Safety in Parallel Execution<a href="#thread-safety-in-parallel-execution" class="hash-link" aria-label="Direct link to Thread Safety in Parallel Execution" title="Direct link to Thread Safety in Parallel Execution" translate="no">​</a></h2>
<p>One of the most important aspects of parallel processing is understanding and managing thread safety correctly. NPipeline&#x27;s parallel execution model is designed to be safe by default, but requires careful attention when accessing shared state.</p>
<blockquote>
<p>🚨 <strong>CRITICAL THREAD SAFETY TRAP</strong></p>
<p><strong>DO NOT access <code>context.Items</code> or <code>context.Parameters</code> during parallel item processing.</strong></p>
<p>These dictionaries are NOT thread-safe. If multiple worker threads try to access them simultaneously, you will get data races that cause:</p>
<ul>
<li class="">Silent data corruption</li>
<li class="">Non-deterministic crashes</li>
<li class="">Impossible-to-reproduce bugs that only show up under production load</li>
</ul>
<p>The cost of learning this the hard way in production is enormous.</p>
</blockquote>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-unsafe-pattern-do-not-use">The Unsafe Pattern (DO NOT USE)<a href="#the-unsafe-pattern-do-not-use" class="hash-link" aria-label="Direct link to The Unsafe Pattern (DO NOT USE)" title="Direct link to The Unsafe Pattern (DO NOT USE)" translate="no">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ❌ WRONG - This is a data race</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class UnsafeMetricsTransform : TransformNode&lt;int, int&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override async ValueTask&lt;int&gt; TransformAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int input,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken ct)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // PROBLEM: Multiple threads access this without synchronization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var count = context.Items.GetValueOrDefault(&quot;processed&quot;, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context.Items[&quot;processed&quot;] = count + 1;  // ← DATA RACE!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // PROBLEM: Multiple threads read/write shared state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (context.Items.ContainsKey(&quot;sum&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            context.Items[&quot;sum&quot;] = (int)context.Items[&quot;sum&quot;] + input;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return input;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Why this breaks:</strong></p>
<ul>
<li class="">Thread A reads count = 5</li>
<li class="">Thread B reads count = 5 (before A writes)</li>
<li class="">Thread A writes count = 6</li>
<li class="">Thread B writes count = 6 (overwrites A&#x27;s write!)</li>
<li class="">Expected: count = 7; Actual: count = 6 (lost update)</li>
<li class="">This happens randomly under load - impossible to debug in development</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-safe-pattern-recommended">The Safe Pattern (RECOMMENDED)<a href="#the-safe-pattern-recommended" class="hash-link" aria-label="Direct link to The Safe Pattern (RECOMMENDED)" title="Direct link to The Safe Pattern (RECOMMENDED)" translate="no">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// ✅ CORRECT - Use IPipelineStateManager for shared state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SafeMetricsTransform : TransformNode&lt;int, int&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override async ValueTask&lt;int&gt; TransformAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int input,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken ct)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // SAFE: IPipelineStateManager handles all synchronization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        var stateManager = context.StateManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (stateManager != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // These operations are internally synchronized</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            await stateManager.IncrementCounterAsync(&quot;processed&quot;, ct);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            await stateManager.IncrementCounterAsync(&quot;sum&quot;, input, ct);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return input;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Why this is safe:</strong></p>
<ul>
<li class="">State manager uses internal locking for all operations</li>
<li class="">All updates are atomic and isolated</li>
<li class="">No data races - thread-safe by design</li>
<li class="">Performance is optimized with fine-grained locking</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-principles">Key Principles<a href="#key-principles" class="hash-link" aria-label="Direct link to Key Principles" title="Direct link to Key Principles" translate="no">​</a></h3>
<p><strong>Independent Item Processing:</strong> Each worker thread processes a different data item. The core processing is inherently thread-safe because workers operate on independent data.</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// SAFE: Each thread processes different items independently</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public override async ValueTask&lt;TOut&gt; TransformAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIn input,                    // Each thread gets a different item</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CancellationToken ct)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Safe to process input without synchronization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return await ProcessItemAsync(input, ct);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Shared State is NOT Thread-Safe:</strong> The <code>PipelineContext</code> dictionaries (Items, Parameters, Properties) are NOT thread-safe. If multiple worker threads need to access or modify shared state, you must use explicit synchronization.</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// UNSAFE: Multiple threads accessing context.Items without synchronization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">context.Items[&quot;counter&quot;] = (int)context.Items.GetValueOrDefault(&quot;counter&quot;, 0) + 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// SAFE: Use IPipelineStateManager for thread-safe shared state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var stateManager = context.StateManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (stateManager != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    await stateManager.IncrementCounterAsync(&quot;counter&quot;, ct);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="three-approaches-to-shared-state">Three Approaches to Shared State<a href="#three-approaches-to-shared-state" class="hash-link" aria-label="Direct link to Three Approaches to Shared State" title="Direct link to Three Approaches to Shared State" translate="no">​</a></h3>
<p>See <a class="" href="/docs/core-concepts/thread-safety">Thread Safety Guidelines</a> for comprehensive guidance, but here&#x27;s a quick summary for parallel scenarios:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-ipipelinestatemanager-recommended">1. IPipelineStateManager (Recommended)<a href="#1-ipipelinestatemanager-recommended" class="hash-link" aria-label="Direct link to 1. IPipelineStateManager (Recommended)" title="Direct link to 1. IPipelineStateManager (Recommended)" translate="no">​</a></h4>
<p>For complex shared state that needs coordination across parallel workers:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public override async ValueTask&lt;TOut&gt; TransformAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIn input,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CancellationToken ct)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var result = ProcessItem(input);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Thread-safe state update via state manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    var stateManager = context.StateManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (stateManager != null)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await stateManager.RecordMetricAsync(&quot;items_processed&quot;, 1, ct);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-node-level-synchronization">2. Node-Level Synchronization<a href="#2-node-level-synchronization" class="hash-link" aria-label="Direct link to 2. Node-Level Synchronization" title="Direct link to 2. Node-Level Synchronization" translate="no">​</a></h4>
<p>For simple synchronization within a single node:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class SynchronizedTransform : TransformNode&lt;int, int&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private readonly object _syncLock = new();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int _total = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override async ValueTask&lt;int&gt; TransformAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int input,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken ct)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lock (_syncLock)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _total += input;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return input;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-atomic-operations-for-simple-counters">3. Atomic Operations for Simple Counters<a href="#3-atomic-operations-for-simple-counters" class="hash-link" aria-label="Direct link to 3. Atomic Operations for Simple Counters" title="Direct link to 3. Atomic Operations for Simple Counters" translate="no">​</a></h4>
<p>For single-value counters without additional logic:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class CountingTransform : TransformNode&lt;int, int&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private long _processedCount = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public override async ValueTask&lt;int&gt; TransformAsync(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int input,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PipelineContext context,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CancellationToken ct)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Interlocked.Increment(ref _processedCount);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return input;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="thread-safety-dos">Thread Safety DO&#x27;s<a href="#thread-safety-dos" class="hash-link" aria-label="Direct link to Thread Safety DO&#x27;s" title="Direct link to Thread Safety DO&#x27;s" translate="no">​</a></h3>
<ul>
<li class="">Process independent data items in parallel (inherently safe)</li>
<li class="">Use <code>IPipelineStateManager</code> for shared state</li>
<li class="">Use <code>lock</code> for simple critical sections</li>
<li class="">Use <code>Interlocked</code> for atomic counter operations</li>
<li class="">Keep synchronization scopes small and fast</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="thread-safety-donts">Thread Safety DON&#x27;Ts<a href="#thread-safety-donts" class="hash-link" aria-label="Direct link to Thread Safety DON&#x27;Ts" title="Direct link to Thread Safety DON&#x27;Ts" translate="no">​</a></h3>
<ul>
<li class="">Directly access or modify <code>context.Items</code> from multiple threads</li>
<li class="">Share mutable state between nodes without explicit synchronization</li>
<li class="">Assume dictionaries in <code>PipelineContext</code> are thread-safe</li>
<li class="">Hold locks across I/O operations (causes contention)</li>
<li class="">Create complex multi-step interlocked sequences (use locks instead)</li>
</ul>
<p><strong>For comprehensive guidance, see <a class="" href="/docs/core-concepts/thread-safety">Thread Safety Guidelines</a>.</strong></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="parallel-execution-configuration-methods">Parallel Execution Configuration Methods<a href="#parallel-execution-configuration-methods" class="hash-link" aria-label="Direct link to Parallel Execution Configuration Methods" title="Direct link to Parallel Execution Configuration Methods" translate="no">​</a></h2>
<p>NPipeline provides multiple ways to configure parallel execution, each suited to different needs:</p>
<ul>
<li class=""><strong>Preset API</strong>: Best for common workload patterns with automatically optimized defaults</li>
<li class=""><strong>Builder API</strong>: Best for flexible customization while starting from sensible defaults</li>
<li class=""><strong>Manual Configuration API</strong>: Best for advanced performance tuning and complex scenarios</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="preset-api-using-workload-type-presets">Preset API: Using Workload Type Presets<a href="#preset-api-using-workload-type-presets" class="hash-link" aria-label="Direct link to Preset API: Using Workload Type Presets" title="Direct link to Preset API: Using Workload Type Presets" translate="no">​</a></h3>
<p>For common workload patterns, use the <code>RunParallel</code> extension method with a workload type to automatically select optimal parallelism configuration:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Extensions.Parallelism;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Pipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public sealed class SimplifiedParallelPipeline : IPipelineDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void DefinePipeline(PipelineBuilder builder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddTransform&lt;MyTransform, Input, Output&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .RunParallel(builder, ParallelWorkloadType.IoBound)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddSink&lt;MySink&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>That&#x27;s it! The <code>RunParallel</code> method with <code>ParallelWorkloadType.IoBound</code> automatically configures:</p>
<ul>
<li class="">Degree of parallelism: <code>ProcessorCount * 4</code> (hide I/O latency)</li>
<li class="">Queue length: <code>ProcessorCount * 8</code></li>
<li class="">Output buffer: <code>ProcessorCount * 16</code></li>
<li class="">Queue policy: Block (apply backpressure)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="workload-type-presets">Workload Type Presets<a href="#workload-type-presets" class="hash-link" aria-label="Direct link to Workload Type Presets" title="Direct link to Workload Type Presets" translate="no">​</a></h3>
<p>NPipeline provides four built-in presets optimized for common workload patterns:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="parallelworkloadtypegeneral-default"><code>ParallelWorkloadType.General</code> (Default)<a href="#parallelworkloadtypegeneral-default" class="hash-link" aria-label="Direct link to parallelworkloadtypegeneral-default" title="Direct link to parallelworkloadtypegeneral-default" translate="no">​</a></h4>
<p><strong>Best for</strong>: Mixed CPU and I/O workloads, when you&#x27;re unsure</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .AddTransform&lt;MyTransform, Input, Output&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .RunParallel(builder, ParallelWorkloadType.General)</span><br></span></code></pre></div></div>
<p><strong>Configuration</strong>:</p>
<ul>
<li class="">DOP: <code>ProcessorCount * 2</code></li>
<li class="">Queue: <code>ProcessorCount * 4</code></li>
<li class="">Buffer: <code>ProcessorCount * 8</code></li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="parallelworkloadtypecpubound"><code>ParallelWorkloadType.CpuBound</code><a href="#parallelworkloadtypecpubound" class="hash-link" aria-label="Direct link to parallelworkloadtypecpubound" title="Direct link to parallelworkloadtypecpubound" translate="no">​</a></h4>
<p><strong>Best for</strong>: CPU-intensive operations, mathematical computations, DSP</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .AddTransform&lt;IntensiveMathTransform, double, double&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .RunParallel(builder, ParallelWorkloadType.CpuBound)</span><br></span></code></pre></div></div>
<p><strong>Configuration</strong> (avoids oversubscription):</p>
<ul>
<li class="">DOP: <code>ProcessorCount</code> (1:1 with CPU cores)</li>
<li class="">Queue: <code>ProcessorCount * 2</code></li>
<li class="">Buffer: <code>ProcessorCount * 4</code></li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="parallelworkloadtypeiobound"><code>ParallelWorkloadType.IoBound</code><a href="#parallelworkloadtypeiobound" class="hash-link" aria-label="Direct link to parallelworkloadtypeiobound" title="Direct link to parallelworkloadtypeiobound" translate="no">​</a></h4>
<p><strong>Best for</strong>: File I/O, database operations, local service calls</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .AddTransform&lt;DatabaseTransform, int, Record&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .RunParallel(builder, ParallelWorkloadType.IoBound)</span><br></span></code></pre></div></div>
<p><strong>Configuration</strong> (high parallelism hides I/O latency):</p>
<ul>
<li class="">DOP: <code>ProcessorCount * 4</code></li>
<li class="">Queue: <code>ProcessorCount * 8</code></li>
<li class="">Buffer: <code>ProcessorCount * 16</code></li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="parallelworkloadtypenetworkbound"><code>ParallelWorkloadType.NetworkBound</code><a href="#parallelworkloadtypenetworkbound" class="hash-link" aria-label="Direct link to parallelworkloadtypenetworkbound" title="Direct link to parallelworkloadtypenetworkbound" translate="no">​</a></h4>
<p><strong>Best for</strong>: HTTP calls, remote service calls, high-latency network operations</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .AddTransform&lt;WebServiceTransform, Request, Response&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .RunParallel(builder, ParallelWorkloadType.NetworkBound)</span><br></span></code></pre></div></div>
<p><strong>Configuration</strong> (maximum throughput under high latency):</p>
<ul>
<li class="">DOP: <code>Min(ProcessorCount * 8, 100)</code> (capped at 100)</li>
<li class="">Queue: <code>200</code> (large buffer)</li>
<li class="">Buffer: <code>400</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="builder-api-fine-grained-control-with-paralleloptionsbuilder">Builder API: Fine-Grained Control with ParallelOptionsBuilder<a href="#builder-api-fine-grained-control-with-paralleloptionsbuilder" class="hash-link" aria-label="Direct link to Builder API: Fine-Grained Control with ParallelOptionsBuilder" title="Direct link to Builder API: Fine-Grained Control with ParallelOptionsBuilder" translate="no">​</a></h3>
<p>When you need to customize beyond the presets, use the fluent builder API for flexible configuration:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .AddTransform&lt;MyTransform, Input, Output&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .RunParallel(builder, opt =&gt; opt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .MaxDegreeOfParallelism(8)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .MaxQueueLength(100)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .DropOldestOnBackpressure()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .OutputBufferCapacity(50)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .AllowUnorderedOutput()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .MetricsInterval(TimeSpan.FromSeconds(2)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .AddSink&lt;MySink&gt;();</span><br></span></code></pre></div></div>
<p>The <code>ParallelOptionsBuilder</code> provides full configuration:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ParallelOptionsBuilder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Configure degree of parallelism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ParallelOptionsBuilder MaxDegreeOfParallelism(int value)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Configure input queue behavior</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ParallelOptionsBuilder MaxQueueLength(int value)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ParallelOptionsBuilder BlockOnBackpressure()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ParallelOptionsBuilder DropOldestOnBackpressure()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ParallelOptionsBuilder DropNewestOnBackpressure()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Configure output buffering</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ParallelOptionsBuilder OutputBufferCapacity(int value)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ParallelOptionsBuilder AllowUnorderedOutput()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Configure metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ParallelOptionsBuilder MetricsInterval(TimeSpan interval)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Build the final options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ParallelOptions Build()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="comparison-configuration-methods">Comparison: Configuration Methods<a href="#comparison-configuration-methods" class="hash-link" aria-label="Direct link to Comparison: Configuration Methods" title="Direct link to Comparison: Configuration Methods" translate="no">​</a></h3>
<table><thead><tr><th>Aspect</th><th>Manual API</th><th>Preset API</th><th>Builder API</th></tr></thead><tbody><tr><td><strong>Lines of code</strong></td><td>5-6</td><td>1</td><td>2-3</td></tr><tr><td><strong>Parameters to understand</strong></td><td>All 5+</td><td>0</td><td>1-2 (as needed)</td></tr><tr><td><strong>Configuration style</strong></td><td>Explicit</td><td>Predefined</td><td>Fluent</td></tr><tr><td><strong>When to use</strong></td><td>Advanced tuning</td><td>Common patterns</td><td>Custom needs</td></tr><tr><td><strong>Learning curve</strong></td><td>Steeper</td><td>Gentle</td><td>Gradual</td></tr></tbody></table>
<p><strong>Manual Configuration</strong>:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.WithBlockingParallelism(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    maxDegreeOfParallelism: Environment.ProcessorCount * 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    maxQueueLength: Environment.ProcessorCount * 8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    outputBufferCapacity: Environment.ProcessorCount * 16)</span><br></span></code></pre></div></div>
<p><strong>Preset API</strong>:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.RunParallel(builder, ParallelWorkloadType.IoBound)</span><br></span></code></pre></div></div>
<p><strong>Builder API</strong>:</p>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.RunParallel(builder, opt =&gt; opt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .MaxDegreeOfParallelism(Environment.ProcessorCount * 4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .MaxQueueLength(Environment.ProcessorCount * 8))</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="when-to-use-each-approach">When to Use Each Approach<a href="#when-to-use-each-approach" class="hash-link" aria-label="Direct link to When to Use Each Approach" title="Direct link to When to Use Each Approach" translate="no">​</a></h3>
<table><thead><tr><th>Scenario</th><th>Recommendation</th></tr></thead><tbody><tr><td>New to NPipeline</td><td>Preset API with <code>ParallelWorkloadType</code></td></tr><tr><td>Typical workloads</td><td>Preset API</td></tr><tr><td>Need slight customization</td><td>Builder API</td></tr><tr><td>Advanced performance tuning</td><td>Manual API</td></tr><tr><td>Prototyping</td><td>Preset API</td></tr><tr><td>Production optimization</td><td>Builder or Manual API (after profiling)</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-full-pipeline-with-simplified-api">Example: Full Pipeline with Simplified API<a href="#example-full-pipeline-with-simplified-api" class="hash-link" aria-label="Direct link to Example: Full Pipeline with Simplified API" title="Direct link to Example: Full Pipeline with Simplified API" translate="no">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Extensions.Parallelism;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using NPipeline.Pipeline;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class FileProcessingPipeline : IPipelineDefinition</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void DefinePipeline(PipelineBuilder builder)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Read files (I/O-bound)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddTransform&lt;FileReaderTransform, string, FileContent&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .RunParallel(builder, ParallelWorkloadType.IoBound)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Parse content (CPU-bound)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddTransform&lt;ParserTransform, FileContent, ParsedData&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .RunParallel(builder, ParallelWorkloadType.CpuBound)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Upload results (network-bound)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddTransform&lt;UploaderTransform, ParsedData, UploadResult&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .RunParallel(builder, ParallelWorkloadType.NetworkBound)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Store results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .AddSink&lt;DatabaseSinkNode&lt;UploadResult&gt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>This example shows how different stages of a pipeline can use different workload types, automatically configured for their specific characteristics.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="validation-of-parallel-configuration">Validation of Parallel Configuration<a href="#validation-of-parallel-configuration" class="hash-link" aria-label="Direct link to Validation of Parallel Configuration" title="Direct link to Validation of Parallel Configuration" translate="no">​</a></h2>
<p>NPipeline includes a <strong>ParallelConfigurationRule</strong> that validates your parallel execution settings at build time, helping prevent common mistakes that can cause performance issues or resource exhaustion.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="automatic-validation">Automatic Validation<a href="#automatic-validation" class="hash-link" aria-label="Direct link to Automatic Validation" title="Direct link to Automatic Validation" translate="no">​</a></h3>
<p>When you build a pipeline with parallel nodes, the validation rule automatically checks:</p>
<ol>
<li class="">
<p><strong>Queue Limits with High Parallelism</strong> - Warns if you have high parallelism (&gt;4) without setting <code>MaxQueueLength</code></p>
<ul>
<li class="">This prevents unbounded memory growth if downstream processing is slower than upstream production</li>
<li class="">Set <code>MaxQueueLength</code> to 2-10x your <code>MaxDegreeOfParallelism</code></li>
</ul>
</li>
<li class="">
<p><strong>Order Preservation Overhead</strong> - Warns if you preserve ordering with high parallelism (&gt;8)</p>
<ul>
<li class="">Preserving order with many workers requires significant buffering and reordering</li>
<li class="">Causes latency as items wait for slower workers to complete</li>
<li class="">Only preserve ordering if downstream requires it</li>
</ul>
</li>
<li class="">
<p><strong>Drop Policies Without Queue Bounds</strong> - Warns if you use drop policies without bounded queues</p>
<ul>
<li class="">Drop policies (<code>DropOldest</code>, <code>DropNewest</code>) only work with bounded queues</li>
<li class="">Without <code>MaxQueueLength</code>, the drop policy has no effect</li>
</ul>
</li>
<li class="">
<p><strong>Thread Explosion Detection</strong> - Warns if parallelism exceeds <code>ProcessorCount * 4</code></p>
<ul>
<li class="">May indicate configuration error or unusual workload</li>
<li class="">Excessive parallelism can cause thread pool starvation</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="validation-in-action">Validation in Action<a href="#validation-in-action" class="hash-link" aria-label="Direct link to Validation in Action" title="Direct link to Validation in Action" translate="no">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">var builder = new PipelineBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ... build pipeline ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Validate before running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var result = builder.Validate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (!result.IsValid)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Console.WriteLine(&quot;Errors:&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    foreach (var error in result.Errors)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Console.WriteLine($&quot;  ❌ {error}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (result.Warnings.Count &gt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Console.WriteLine(&quot;Warnings:&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    foreach (var warning in result.Warnings)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Console.WriteLine($&quot;  ⚠️  {warning}&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Example output:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ⚠️  Node &#x27;transform&#x27; has high parallelism (16) but no queue limit (MaxQueueLength is null).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//     Consider setting MaxQueueLength to prevent unbounded memory growth.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ⚠️  Node &#x27;transform&#x27; preserves ordering with high parallelism (16). This may cause </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//     significant output buffering and latency. If ordering is not critical, consider </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//     .AllowUnorderedOutput() to improve throughput.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="quick-fix-examples">Quick Fix Examples<a href="#quick-fix-examples" class="hash-link" aria-label="Direct link to Quick Fix Examples" title="Direct link to Quick Fix Examples" translate="no">​</a></h3>
<div class="language-csharp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-csharp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// PROBLEM: High parallelism without queue limits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var parallelOptions = new ParallelOptions(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MaxDegreeOfParallelism: 16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MaxQueueLength: null);  // ⚠️ Warning!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// FIX: Set appropriate queue length</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var parallelOptions = new ParallelOptions(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MaxDegreeOfParallelism: 16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MaxQueueLength: 100);  // ✅ OK - Bounded to 6x parallelism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// PROBLEM: Preserving order with high parallelism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var options = builder.AddTransform&lt;MyTransform, Input, Output&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .RunParallel(builder, opt =&gt; opt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .MaxDegreeOfParallelism(16)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .PreserveOrdering: true);  // ⚠️ High latency warning!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// FIX: Disable ordering for throughput</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">var options = builder.AddTransform&lt;MyTransform, Input, Output&gt;()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .RunParallel(builder, opt =&gt; opt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .MaxDegreeOfParallelism(16)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .AllowUnorderedOutput());  // ✅ Better throughput</span><br></span></code></pre></div></div>
<p>For complete validation documentation, see <a class="" href="/docs/core-concepts/pipeline-validation#parallel-configuration-rule-details">Parallel Configuration Rule Details</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="considerations-for-parallelism">Considerations for Parallelism<a href="#considerations-for-parallelism" class="hash-link" aria-label="Direct link to Considerations for Parallelism" title="Direct link to Considerations for Parallelism" translate="no">​</a></h2>
<ul>
<li class="">
<p><strong>Degree of Parallelism:</strong> Carefully choose the <code>MaxDegreeOfParallelism</code>. Too high a value can lead to excessive resource consumption (CPU, memory, threads) and diminish returns due to context switching overhead. Too low a value might underutilize available resources.</p>
</li>
<li class="">
<p><strong>Thread Safety:</strong> Ensure that any shared state or external resources accessed by your parallel nodes are thread-safe. If your nodes are pure functions (operating only on their input and producing output without side effects), this is less of a concern.</p>
</li>
<li class="">
<p><strong>Order Preservation:</strong> By default, NPipeline maintains the order of items even when processing them in parallel. If order is not critical and you need maximum throughput, you can configure nodes to not preserve order by setting <code>PreserveOrdering = false</code>.</p>
</li>
<li class="">
<p><strong>Resource Contention:</strong> Be aware of potential bottlenecks when multiple parallel tasks try to access the same limited resource (e.g., a single database connection, a slow API).</p>
</li>
<li class="">
<p><strong>Debugging:</strong> Debugging parallel code can be more complex. Ensure you have good logging and monitoring in place.</p>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices" translate="no">​</a></h2>
<ul>
<li class="">
<p><strong>Identify Parallelizable Work:</strong> Apply parallelism to parts of your pipeline where operations are independent and computationally intensive.</p>
</li>
<li class="">
<p><strong>Start Small:</strong> Begin with a low degree of parallelism and incrementally increase it while monitoring performance metrics (CPU, memory, throughput) to find the optimal balance.</p>
</li>
<li class="">
<p><strong>Profile:</strong> Use profiling tools to identify bottlenecks and ensure that parallelism is indeed improving performance.</p>
</li>
</ul>
<p>By strategically applying parallelism, you can significantly boost the processing capabilities of your NPipelines for demanding workloads.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps" translate="no">​</a></h2>
<ul>
<li class=""><strong><a class="" href="/docs/core-concepts/thread-safety">Thread Safety Guidelines</a></strong>: Comprehensive guide to thread safety and shared state management</li>
<li class=""><strong><a class="" href="/docs/extensions/dependency-injection">Dependency Injection</a></strong>: Learn how to integrate NPipeline with dependency injection frameworks</li>
<li class=""><strong><a class="" href="/docs/extensions/testing">Testing Pipelines</a></strong>: Understand how to effectively test your parallel pipelines</li>
</ul></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/extensions/dependency-injection"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Dependency Injection</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/extensions/testing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Testing Extensions</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#understanding-parallelism-in-npipeline" class="table-of-contents__link toc-highlight">Understanding Parallelism in NPipeline</a></li><li><a href="#npipelineextensionsparallelism" class="table-of-contents__link toc-highlight"><code>NPipeline.Extensions.Parallelism</code></a><ul><li><a href="#important-thread-safety" class="table-of-contents__link toc-highlight">Important: Thread Safety</a></li><li><a href="#example-parallel-transform" class="table-of-contents__link toc-highlight">Example: Parallel Transform</a></li></ul></li><li><a href="#non-ordered-parallel-execution-for-maximum-throughput" class="table-of-contents__link toc-highlight">Non-Ordered Parallel Execution for Maximum Throughput</a><ul><li><a href="#example-non-ordered-parallel-processing" class="table-of-contents__link toc-highlight">Example: Non-Ordered Parallel Processing</a></li><li><a href="#when-to-use-non-ordered-execution" class="table-of-contents__link toc-highlight">When to Use Non-Ordered Execution</a></li><li><a href="#trade-offs" class="table-of-contents__link toc-highlight">Trade-offs</a></li></ul></li><li><a href="#advanced-parallel-options" class="table-of-contents__link toc-highlight">Advanced Parallel Options</a><ul><li><a href="#metrics-configuration" class="table-of-contents__link toc-highlight">Metrics Configuration</a></li><li><a href="#queue-policies" class="table-of-contents__link toc-highlight">Queue Policies</a></li><li><a href="#default-queue-length" class="table-of-contents__link toc-highlight">Default Queue Length</a></li></ul></li><li><a href="#thread-safety-in-parallel-execution" class="table-of-contents__link toc-highlight">Thread Safety in Parallel Execution</a><ul><li><a href="#the-unsafe-pattern-do-not-use" class="table-of-contents__link toc-highlight">The Unsafe Pattern (DO NOT USE)</a></li><li><a href="#the-safe-pattern-recommended" class="table-of-contents__link toc-highlight">The Safe Pattern (RECOMMENDED)</a></li><li><a href="#key-principles" class="table-of-contents__link toc-highlight">Key Principles</a></li><li><a href="#three-approaches-to-shared-state" class="table-of-contents__link toc-highlight">Three Approaches to Shared State</a></li><li><a href="#thread-safety-dos" class="table-of-contents__link toc-highlight">Thread Safety DO&#39;s</a></li><li><a href="#thread-safety-donts" class="table-of-contents__link toc-highlight">Thread Safety DON&#39;Ts</a></li></ul></li><li><a href="#parallel-execution-configuration-methods" class="table-of-contents__link toc-highlight">Parallel Execution Configuration Methods</a><ul><li><a href="#preset-api-using-workload-type-presets" class="table-of-contents__link toc-highlight">Preset API: Using Workload Type Presets</a></li><li><a href="#workload-type-presets" class="table-of-contents__link toc-highlight">Workload Type Presets</a></li><li><a href="#builder-api-fine-grained-control-with-paralleloptionsbuilder" class="table-of-contents__link toc-highlight">Builder API: Fine-Grained Control with ParallelOptionsBuilder</a></li><li><a href="#comparison-configuration-methods" class="table-of-contents__link toc-highlight">Comparison: Configuration Methods</a></li><li><a href="#when-to-use-each-approach" class="table-of-contents__link toc-highlight">When to Use Each Approach</a></li><li><a href="#example-full-pipeline-with-simplified-api" class="table-of-contents__link toc-highlight">Example: Full Pipeline with Simplified API</a></li></ul></li><li><a href="#validation-of-parallel-configuration" class="table-of-contents__link toc-highlight">Validation of Parallel Configuration</a><ul><li><a href="#automatic-validation" class="table-of-contents__link toc-highlight">Automatic Validation</a></li><li><a href="#validation-in-action" class="table-of-contents__link toc-highlight">Validation in Action</a></li><li><a href="#quick-fix-examples" class="table-of-contents__link toc-highlight">Quick Fix Examples</a></li></ul></li><li><a href="#considerations-for-parallelism" class="table-of-contents__link toc-highlight">Considerations for Parallelism</a></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/why-npipeline">Why NPipeline?</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/installation">Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/quick-start">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/core-concepts">Core Concepts</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/npipeline/npipeline" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">&nbsp;</div></div></div></footer></div>
</body>
</html>